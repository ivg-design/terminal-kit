<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTextareaLit - Component Demo</title>
    <link rel="stylesheet" href="../css/demo-template.css">
    <link rel="stylesheet" href="../public/js/libs/prismjs/prism-terminal-kit.css">

    <style>
        .info-box {
            background: var(--terminal-black);
            border: 1px solid var(--terminal-green-dim);
            padding: 10px;
            margin-bottom: 15px;
            font-size: 11px;
            color: var(--terminal-green-dim);
        }
        .keyboard-shortcuts {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 20px;
            font-size: 11px;
            color: var(--terminal-green-dim);
        }
        .shortcut-key {
            color: var(--terminal-green);
            font-weight: bold;
        }
        #charCount {
            text-align: right;
            margin-top: 5px;
            color: var(--terminal-green-dim);
            font-size: 11px;
        }
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <header class="demo-header">
        <div class="demo-header-content">
            <div class="demo-header-left">
                <h1>TTextareaLit</h1>
                <div class="breadcrumb">
                    <a href="index.html">← Components</a> / Textarea
                </div>
            </div>
            <div class="demo-header-controls">
                <button class="header-btn" id="toggleLogBtn">▼ Event Log</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="demo-container">
        <div class="component-section">
            <h2 class="component-title">Textarea Component</h2>
            <p class="component-description">
                Multi-line text input with resize control, line numbers, code mode, and syntax highlighting.
            </p>

            <h3>Resize Control</h3>
            <div class="demo-grid">
                <div class="demo-item">
                    <span class="demo-label">Resize Both (default)</span>
                    <t-textarea placeholder="Drag corner to resize width & height..." rows="4"></t-textarea>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Resize Vertical Only</span>
                    <t-textarea placeholder="Only height resizing..." rows="4" resize="vertical"></t-textarea>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Resize Horizontal Only</span>
                    <t-textarea placeholder="Only width resizing..." rows="4" resize="horizontal"></t-textarea>
                </div>
                <div class="demo-item">
                    <span class="demo-label">No Resize (fixed)</span>
                    <t-textarea placeholder="Cannot be resized at all..." rows="4" resize="none"></t-textarea>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Read-only</span>
                    <t-textarea value="This content is read-only.
You cannot edit or resize it." readonly rows="3"></t-textarea>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Disabled</span>
                    <t-textarea value="This textarea is disabled" disabled rows="3"></t-textarea>
                </div>
            </div>

            <h3>Programmatic Size Control</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Size Presets</span>
                    <div class="controls" style="margin-bottom: 10px;">
                        <button onclick="setSizePreset('compact')">Compact (2 rows)</button>
                        <button onclick="setSizePreset('standard')">Standard (4 rows)</button>
                        <button onclick="setSizePreset('large')">Large (8 rows)</button>
                        <button onclick="setSizePreset('full')">Full (15 rows)</button>
                    </div>
                    <t-textarea id="programmaticSize" placeholder="Click buttons above to change my size..." rows="4" resize="none"></t-textarea>
                </div>
            </div>

            <h3>Code Editor Mode</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Code Editor with Line Numbers</span>
                    <div class="info-box">
                        <strong>IDE Keyboard Shortcuts:</strong>
                        <div class="keyboard-shortcuts">
                            <span class="shortcut-key">Tab</span><span>Insert tab / Indent selection</span>
                            <span class="shortcut-key">Shift+Tab</span><span>Outdent current line or selection</span>
                            <span class="shortcut-key">Enter</span><span>Auto-indent new line</span>
                            <span class="shortcut-key">Ctrl/Cmd + D</span><span>Duplicate current line</span>
                        </div>
                    </div>
                    <t-textarea
                        id="codeEditor"
                        show-line-numbers code-mode
                        placeholder="// Enter your code here..."
                        rows="12"
                        value="function fibonacci(n) {
  if (n <= 1) return n;

  let prev = 0;
  let curr = 1;

  for (let i = 2; i <= n; i++) {
    const temp = curr;
    curr = prev + curr;
    prev = temp;
  }

  return curr;
}

// Test the function
console.log(fibonacci(10)); // Output: 55"></t-textarea>
                    <div class="controls" style="margin-top: 10px;">
                        <button onclick="const e=document.getElementById('codeEditor'); e.showLineNumbers=!e.showLineNumbers;">Toggle Line Numbers</button>
                        <button onclick="document.getElementById('codeEditor').focus()">Focus Editor</button>
                        <button onclick="copyToClipboard()">Copy to Clipboard</button>
                    </div>
                </div>
            </div>

            <h3>Syntax Highlighting</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">JavaScript with Syntax Highlighting</span>
                    <div class="controls" style="margin-bottom: 10px;">
                        <label style="margin-right: 10px;">Language:</label>
                        <select id="jsLang" onchange="document.getElementById('jsEditor').language = this.value" style="background: var(--terminal-gray-dark); color: var(--terminal-green); border: 1px solid var(--terminal-green); padding: 5px;">
                            <option value="javascript">JavaScript</option>
                            <option value="markup">HTML</option>
                            <option value="css">CSS</option>
                            <option value="none">Plain Text</option>
                        </select>
                        <button onclick="const e=document.getElementById('jsEditor'); e.showLineNumbers=!e.showLineNumbers;">Toggle Line Numbers</button>
                    </div>
                    <t-textarea
                        id="jsEditor"
                        code-mode
                        show-line-numbers
                        language="javascript"
                        rows="12"
                        value="function fibonacci(n) {
  if (n <= 1) return n;

  let prev = 0;
  let curr = 1;

  for (let i = 2; i <= n; i++) {
    const temp = curr;
    curr = prev + curr;
    prev = temp;
  }

  return curr;
}

// Test the function
console.log(fibonacci(10)); // Output: 55"></t-textarea>
                </div>
            </div>

            <h3>Markdown Editor with Live Preview</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Edit markdown on the left, see rendered preview on the right</span>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                        <div>
                            <div style="font-size: 11px; color: var(--terminal-green-dim); margin-bottom: 5px;">MARKDOWN SOURCE</div>
                            <t-textarea id="markdownEditor" rows="12" code-mode language="markdown" value="# Hello Terminal-Kit

This is **bold** text and this is *italic* text.

## Features

- Feature one
- Feature two
- Feature three

### Code Example

\`\`\`javascript
const greeting = 'Hello World!';
console.log(greeting);
\`\`\`

> Blockquote: This is a quote from someone important.

Visit [Terminal-Kit](https://github.com) for more info."></t-textarea>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--terminal-green-dim); margin-bottom: 5px;">RENDERED PREVIEW</div>
                            <div id="markdownPreview" style="background: var(--terminal-gray-dark); border: 1px solid var(--terminal-green-dim); padding: 15px; min-height: 260px; overflow: auto; font-family: var(--font-mono, 'Courier New', monospace); font-size: 12px; line-height: 1.5;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <h3>Interactive Examples</h3>
            <div class="demo-grid">
                <div class="demo-item">
                    <span class="demo-label">Character Counter</span>
                    <t-textarea id="charCounter" placeholder="Type something (max 280 chars)..." rows="4"></t-textarea>
                    <div id="charCount">0 / 280 characters</div>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Auto-growing Textarea</span>
                    <t-textarea id="autoGrow" placeholder="This textarea grows as you type..." rows="2" resize="none"></t-textarea>
                </div>
            </div>

            <div class="code-block">
                <code>&lt;!-- Basic textarea --&gt;
&lt;t-textarea rows="4"&gt;&lt;/t-textarea&gt;

&lt;!-- Resize options --&gt;
&lt;t-textarea resize="vertical"&gt;&lt;/t-textarea&gt;
&lt;t-textarea resize="horizontal"&gt;&lt;/t-textarea&gt;
&lt;t-textarea resize="none"&gt;&lt;/t-textarea&gt;

&lt;!-- Code mode with line numbers --&gt;
&lt;t-textarea code-mode show-line-numbers rows="15"&gt;&lt;/t-textarea&gt;

&lt;!-- Syntax highlighting --&gt;
&lt;t-textarea code-mode language="javascript"&gt;&lt;/t-textarea&gt;
&lt;t-textarea code-mode language="markup"&gt;&lt;/t-textarea&gt;
&lt;t-textarea code-mode language="css"&gt;&lt;/t-textarea&gt;

&lt;!-- Events --&gt;
&lt;script&gt;
textarea.addEventListener('textarea-input', (e) =&gt; {});
textarea.addEventListener('textarea-change', (e) =&gt; {});
textarea.addEventListener('textarea-focus', (e) =&gt; {});
textarea.addEventListener('textarea-blur', (e) =&gt; {});
&lt;/script&gt;</code>
            </div>
        </div>
    </div>

    <!-- Floating Event Log -->
    <div class="event-log-container collapsed" id="eventLogContainer">
        <div class="event-log-toggle">
            <h3><span class="toggle-icon">▲</span> Event Log</h3>
            <div class="event-log-controls">
                <span class="event-log-count">0</span>
                <button class="event-log-clear">Clear</button>
            </div>
        </div>
        <div class="event-log" id="eventLog"></div>
    </div>

    <script type="module">
        import '../js/components/TTextareaLit.js';

        // Event log functionality
        let eventCount = 0;
        const eventLog = document.getElementById('eventLog');
        const eventLogContainer = document.getElementById('eventLogContainer');
        const countEl = document.querySelector('.event-log-count');
        const toggleLogBtn = document.getElementById('toggleLogBtn');

        function logEvent(component, event, detail) {
            const entry = document.createElement('div');
            entry.className = 'event-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${component}: ${event}${detail ? ' - ' + JSON.stringify(detail) : ''}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
            eventCount++;
            countEl.textContent = eventCount;
        }

        // Toggle event log
        document.querySelector('.event-log-toggle').addEventListener('click', (e) => {
            if (e.target.closest('.event-log-clear')) return;
            eventLogContainer.classList.toggle('collapsed');
            toggleLogBtn.classList.toggle('active');
        });

        toggleLogBtn.addEventListener('click', () => {
            eventLogContainer.classList.toggle('collapsed');
            toggleLogBtn.classList.toggle('active');
        });

        // Clear log
        document.querySelector('.event-log-clear').addEventListener('click', (e) => {
            e.stopPropagation();
            eventLog.innerHTML = '';
            eventCount = 0;
            countEl.textContent = '0';
        });

        // Add event listeners to all textareas
        document.addEventListener('DOMContentLoaded', () => {
            const textareas = document.querySelectorAll('t-textarea');
            textareas.forEach((textarea) => {
                const id = textarea.id || textarea.getAttribute('placeholder')?.substring(0, 20) || 'Textarea';

                textarea.addEventListener('textarea-input', (e) => {
                    const value = e.detail?.value || '';
                    const preview = value.substring(0, 50);
                    logEvent(id, 'textarea-input', { preview: preview + (value.length > 50 ? '...' : '') });
                });

                textarea.addEventListener('textarea-change', (e) => {
                    const value = e.detail?.value || '';
                    logEvent(id, 'textarea-change', { length: value.length });
                });

                textarea.addEventListener('textarea-focus', () => {
                    logEvent(id, 'textarea-focus');
                });

                textarea.addEventListener('textarea-blur', () => {
                    logEvent(id, 'textarea-blur');
                });
            });

            // Character counter
            const charCounter = document.getElementById('charCounter');
            const charCount = document.getElementById('charCount');
            const maxChars = 280;

            if (charCounter && charCount) {
                charCounter.addEventListener('textarea-input', (e) => {
                    const length = e.detail.value.length;
                    charCount.textContent = `${length} / ${maxChars} characters`;

                    if (length > maxChars) {
                        charCount.style.color = 'var(--terminal-red)';
                    } else if (length > maxChars * 0.9) {
                        charCount.style.color = 'var(--terminal-amber)';
                    } else {
                        charCount.style.color = 'var(--terminal-green-dim)';
                    }
                });
            }

            // Auto-growing textarea
            const autoGrow = document.getElementById('autoGrow');
            if (autoGrow) {
                autoGrow.addEventListener('textarea-input', (e) => {
                    const lines = e.detail.value.split('\n').length;
                    const newRows = Math.max(3, Math.min(lines + 1, 15));
                    autoGrow.rows = newRows;
                });
            }

            // Markdown preview
            const markdownEditor = document.getElementById('markdownEditor');
            const markdownPreview = document.getElementById('markdownPreview');

            if (markdownEditor && markdownPreview) {
                // Simple markdown renderer (basic implementation)
                const renderMarkdown = (md) => {
                    let html = md
                        // Code blocks
                        .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre style="background:#1a1a1a;padding:10px;border:1px solid #333;overflow-x:auto;"><code>$2</code></pre>')
                        // Inline code
                        .replace(/`([^`]+)`/g, '<code style="background:#1a1a1a;padding:2px 5px;border:1px solid #333;">$1</code>')
                        // Headers
                        .replace(/^### (.+)$/gm, '<h3 style="color:var(--terminal-green);margin:15px 0 10px;">$1</h3>')
                        .replace(/^## (.+)$/gm, '<h2 style="color:var(--terminal-green);margin:15px 0 10px;">$1</h2>')
                        .replace(/^# (.+)$/gm, '<h1 style="color:var(--terminal-green);margin:15px 0 10px;">$1</h1>')
                        // Bold/Italic
                        .replace(/\*\*([^*]+)\*\*/g, '<strong style="color:var(--terminal-green);">$1</strong>')
                        .replace(/\*([^*]+)\*/g, '<em style="color:var(--terminal-green-dim);">$1</em>')
                        // Links
                        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" style="color:var(--terminal-cyan);text-decoration:underline;">$1</a>')
                        // Blockquotes
                        .replace(/^> (.+)$/gm, '<blockquote style="border-left:3px solid var(--terminal-green);padding-left:15px;margin:10px 0;color:var(--terminal-green-dim);">$1</blockquote>')
                        // Unordered lists
                        .replace(/^- (.+)$/gm, '<li style="margin-left:20px;">$1</li>')
                        // Paragraphs (blank lines)
                        .replace(/\n\n/g, '</p><p style="margin:10px 0;color:var(--terminal-green-dim);">')
                        // Line breaks
                        .replace(/\n/g, '<br>');

                    return '<p style="margin:10px 0;color:var(--terminal-green-dim);">' + html + '</p>';
                };

                // Initial render
                markdownPreview.innerHTML = renderMarkdown(markdownEditor.value);

                // Update on input
                markdownEditor.addEventListener('textarea-input', (e) => {
                    markdownPreview.innerHTML = renderMarkdown(e.detail.value);
                    logEvent('markdownEditor', 'preview-updated');
                });
            }

            logEvent('System', 'Demo initialized');
        });

        // Copy to clipboard
        window.copyToClipboard = async () => {
            const codeEditor = document.getElementById('codeEditor');
            if (codeEditor) {
                const text = codeEditor.value;
                try {
                    await navigator.clipboard.writeText(text);
                    logEvent('CodeEditor', 'copied to clipboard');
                } catch (err) {
                    logEvent('CodeEditor', 'copy failed', { error: err.message });
                }
            }
        };

        // Programmatic size control
        window.setSizePreset = (preset) => {
            const textarea = document.getElementById('programmaticSize');
            if (!textarea) return;

            const presets = {
                compact: 2,
                standard: 4,
                large: 8,
                full: 15
            };

            textarea.rows = presets[preset] || 4;
            logEvent('ProgrammaticSize', `Size changed to ${preset}`, { rows: presets[preset] });
        };
    </script>

    <!-- Prism.js for syntax highlighting -->
    <script src="../public/js/libs/prismjs/prism.js"></script>
    <script src="../public/js/libs/prismjs/prism-markup.min.js"></script>
    <script src="../public/js/libs/prismjs/prism-css.min.js"></script>
    <script src="../public/js/libs/prismjs/prism-javascript.min.js"></script>
    <script type="module" src="../js/utils/demo-color-picker.js"></script>
</body>
</html>
