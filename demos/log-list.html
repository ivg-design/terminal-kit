<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log List - Terminal Components</title>
    <link rel="stylesheet" href="../css/theme/terminal.css">
    <style>
        :root {
            --terminal-black: #0a0a0a;
            --terminal-gray-darkest: #1a1a1a;
            --terminal-gray-dark: #333;
            --terminal-green: #00ff41;
            --font-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-mono);
            background: var(--terminal-black);
            color: var(--terminal-green);
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            font-size: 18px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .subtitle {
            font-size: 12px;
            color: #888;
            margin-bottom: 24px;
        }

        .demo-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 14px;
            color: var(--terminal-green);
            margin-bottom: 12px;
            padding: 8px 12px;
            background: var(--terminal-gray-darkest);
            border-left: 3px solid var(--terminal-green);
        }

        .demo-container {
            height: 400px;
            border: 1px solid var(--terminal-gray-dark);
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 12px;
            background: var(--terminal-gray-darkest);
            border: 1px solid var(--terminal-gray-dark);
            color: var(--terminal-green);
            font-family: var(--font-mono);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            border-color: var(--terminal-green);
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.2);
        }

        .btn.active {
            background: var(--terminal-green);
            color: var(--terminal-black);
        }

        .event-log {
            margin-top: 12px;
            padding: 12px;
            background: var(--terminal-gray-darkest);
            border: 1px solid var(--terminal-gray-dark);
            font-size: 11px;
            max-height: 150px;
            overflow-y: auto;
        }

        .event-log-title {
            color: var(--terminal-green);
            margin-bottom: 8px;
        }

        .event-entry {
            color: #888;
            padding: 2px 0;
            border-bottom: 1px solid #222;
        }

        .static-entries {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 12px;
            background: var(--terminal-gray-darkest);
            border: 1px solid var(--terminal-gray-dark);
        }
    </style>
</head>

<body>
    <h1>Log List Component</h1>
    <p class="subtitle">Terminal-style log viewer with filtering, collapsible entries, and structured data</p>

    <!-- Basic Log List -->
    <div class="demo-section">
        <h2 class="section-title">Interactive Log Viewer</h2>
        <div class="controls">
            <button class="btn" id="add-debug">Add Debug</button>
            <button class="btn" id="add-info">Add Info</button>
            <button class="btn" id="add-warn">Add Warning</button>
            <button class="btn" id="add-error">Add Error</button>
            <button class="btn" id="add-success">Add Success</button>
            <button class="btn" id="add-batch">Add Batch (10)</button>
            <button class="btn" id="simulate-stream">Simulate Stream</button>
            <button class="btn" id="clear-log">Clear All</button>
        </div>
        <div class="demo-container">
            <t-log-list id="demo-log" show-toolbar max-entries="100"></t-log-list>
        </div>
        <div class="event-log">
            <div class="event-log-title">Events:</div>
            <div id="events"></div>
        </div>
    </div>

    <!-- Single Log Entry Examples -->
    <div class="demo-section">
        <h2 class="section-title">Individual Log Entries</h2>
        <div class="static-entries" id="static-entries">
            <!-- Populated via JS -->
        </div>
    </div>

    <!-- Compact Mode -->
    <div class="demo-section">
        <h2 class="section-title">Compact Display Mode</h2>
        <div class="static-entries" id="compact-entries">
            <!-- Populated via JS -->
        </div>
    </div>

    <!-- JSON Metadata Example -->
    <div class="demo-section">
        <h2 class="section-title">Entry with JSON Metadata</h2>
        <div class="static-entries" id="metadata-entry">
            <!-- Populated via JS -->
        </div>
    </div>

    <script type="module">
        import '../js/components/TLogListLit.js';
        import '../js/components/TLogEntryLit.js';

        // Wait for component registration
        await Promise.all([
            customElements.whenDefined('t-log-list'),
            customElements.whenDefined('t-log-entry')
        ]);

        const logList = document.getElementById('demo-log');
        const eventsDiv = document.getElementById('events');

        // Helper to create entry element
        function createEntryEl(config) {
            const el = document.createElement('t-log-entry');
            Object.entries(config).forEach(([key, value]) => {
                if (typeof value === 'object' && value !== null) {
                    el[key] = value;
                } else if (typeof value === 'boolean') {
                    if (value) el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), '');
                } else if (value !== undefined && value !== null && value !== '') {
                    el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), value);
                }
            });
            return el;
        }

        // Create static examples
        const staticContainer = document.getElementById('static-entries');
        const staticExamples = [
            { level: 'debug', message: 'Debug message with trace info', source: 'parser', timestampFormat: 'time', tags: ['verbose', 'trace'] },
            { level: 'info', message: 'Application started successfully', source: 'main', timestampFormat: 'datetime' },
            { level: 'warn', message: 'Memory usage exceeds 80% threshold', source: 'monitor', tags: ['performance', 'memory'], details: { 'Current Usage': '82%', 'Threshold': '80%', 'Heap Size': '512MB' } },
            { level: 'error', message: 'Failed to connect to database', source: 'db', tags: ['critical', 'database'], details: { 'Host': 'localhost:5432', 'Database': 'app_db', 'Error Code': 'ECONNREFUSED' }, stack: 'Error: Failed to connect to database\n    at DBConnection.connect (/app/db/connection.js:45:11)\n    at async startServer (/app/server.js:23:5)' },
            { level: 'success', message: 'Deployment completed successfully', source: 'deploy', tags: ['production', 'release'], details: { 'Version': 'v2.3.1', 'Environment': 'production', 'Duration': '45s' } }
        ];
        staticExamples.forEach(ex => staticContainer.appendChild(createEntryEl(ex)));

        // Create compact examples
        const compactContainer = document.getElementById('compact-entries');
        [
            { level: 'info', message: 'Compact mode reduces visual weight', source: 'ui', compact: true },
            { level: 'warn', message: 'Warning in compact mode', source: 'lint', compact: true },
            { level: 'error', message: 'Error in compact mode', source: 'test', compact: true }
        ].forEach(ex => compactContainer.appendChild(createEntryEl(ex)));

        // Create metadata example
        const metadataContainer = document.getElementById('metadata-entry');
        const metaEntry = createEntryEl({
            level: 'info',
            message: 'API request completed',
            source: 'api',
            expanded: true,
            tags: ['http', 'request'],
            details: { 'Method': 'POST', 'URL': '/api/users', 'Status': '201 Created', 'Duration': '234ms' },
            metadata: {
                request: {
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ***' },
                    body: { name: 'John Doe', email: 'john@example.com' }
                },
                response: { id: 12345, created_at: '2024-01-15T10:30:00Z' }
            }
        });
        metadataContainer.appendChild(metaEntry);

        // Add initial entries to log list
        logList.addEntries([
            { level: 'info', message: 'Log viewer initialized', source: 'system' },
            { level: 'debug', message: 'Loading configuration from environment', source: 'config', tags: ['startup'] },
            { level: 'info', message: 'Connected to database', source: 'db', details: { host: 'localhost', port: 5432 } },
            { level: 'warn', message: 'Cache miss rate above threshold', source: 'cache', tags: ['performance'] },
            { level: 'success', message: 'Server listening on port 3000', source: 'http' }
        ]);

        // Event logging
        function logEvent(name, detail) {
            const entry = document.createElement('div');
            entry.className = 'event-entry';
            entry.textContent = `${new Date().toLocaleTimeString()} - ${name}: ${JSON.stringify(detail).substring(0, 80)}`;
            eventsDiv.insertBefore(entry, eventsDiv.firstChild);
            if (eventsDiv.children.length > 20) {
                eventsDiv.removeChild(eventsDiv.lastChild);
            }
        }

        logList.addEventListener('entry-click', e => logEvent('entry-click', e.detail));
        logList.addEventListener('entry-expand', e => logEvent('entry-expand', e.detail));
        logList.addEventListener('tag-click', e => logEvent('tag-click', e.detail));
        logList.addEventListener('clear', () => logEvent('clear', {}));

        // Button handlers
        const messages = {
            debug: ['Parsing configuration file', 'Loading module dependencies', 'Initializing event loop', 'Binding socket listeners'],
            info: ['User authenticated successfully', 'Session created', 'Request processed', 'Cache updated'],
            warn: ['Deprecated API usage detected', 'Rate limit approaching', 'Memory usage high', 'Slow query detected'],
            error: ['Connection refused', 'Timeout exceeded', 'Invalid token', 'File not found'],
            success: ['Build completed', 'Tests passed', 'Deployment successful', 'Migration finished']
        };

        const sources = ['api', 'auth', 'db', 'cache', 'worker', 'queue', 'http', 'ws'];
        const tagsList = ['performance', 'security', 'network', 'io', 'memory', 'cpu'];

        function randomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function createEntry(level) {
            return {
                level,
                message: randomItem(messages[level]),
                source: randomItem(sources),
                tags: Math.random() > 0.5 ? [randomItem(tagsList)] : [],
                details: Math.random() > 0.7 ? { requestId: Math.random().toString(36).substr(2, 9) } : null
            };
        }

        document.getElementById('add-debug').addEventListener('click', () => logList.addEntry(createEntry('debug')));
        document.getElementById('add-info').addEventListener('click', () => logList.addEntry(createEntry('info')));
        document.getElementById('add-warn').addEventListener('click', () => logList.addEntry(createEntry('warn')));
        document.getElementById('add-error').addEventListener('click', () => logList.addEntry(createEntry('error')));
        document.getElementById('add-success').addEventListener('click', () => logList.addEntry(createEntry('success')));

        document.getElementById('add-batch').addEventListener('click', () => {
            const levels = ['debug', 'info', 'warn', 'error', 'success'];
            const entries = Array.from({ length: 10 }, () => createEntry(randomItem(levels)));
            logList.addEntries(entries);
        });

        document.getElementById('clear-log').addEventListener('click', () => logList.clear());

        let streamInterval = null;
        document.getElementById('simulate-stream').addEventListener('click', function() {
            if (streamInterval) {
                clearInterval(streamInterval);
                streamInterval = null;
                this.textContent = 'Simulate Stream';
                this.classList.remove('active');
            } else {
                const levels = ['debug', 'info', 'info', 'info', 'warn', 'error'];
                streamInterval = setInterval(() => {
                    logList.addEntry(createEntry(randomItem(levels)));
                }, 500);
                this.textContent = 'Stop Stream';
                this.classList.add('active');
            }
        });
    </script>
    <script type="module" src="../js/utils/demo-color-picker.js"></script>
</body>

</html>
