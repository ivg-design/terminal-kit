<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTreeLit - Component Demo</title>

    <!-- Demo Template Styles -->
    <link rel="stylesheet" href="../css/demo-template.css">

    <style>
        t-tree {
            height: 250px;
            width: 100%;
            max-width: 100%;
            border: 1px solid var(--terminal-gray-light);
        }

        .selection-info {
            margin-top: 10px;
            font-size: 11px;
            color: var(--terminal-amber);
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="breadcrumb">
            <a href="index.html">&larr; Back to Gallery</a> / Tree
        </div>

        <h1>TTreeLit</h1>

        <div class="component-section">
            <h2 class="component-title">Hierarchical Tree</h2>
            <p class="component-description">
                Tree component with expand/collapse, selection modes, checkboxes, search, drag-and-drop, and lazy loading.
            </p>

            <h3>Basic Variants</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Basic File Tree</span>
                    <t-tree id="basic-tree"></t-tree>
                </div>

                <div class="demo-item">
                    <span class="demo-label">Single Selection</span>
                    <t-tree id="single-select" selectable="single"></t-tree>
                    <div class="selection-info">Selected: <span id="single-selected">None</span></div>
                </div>
            </div>

            <h3>Checkboxes & Multi-Select</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Multiple Selection with Checkboxes</span>
                    <div class="controls" style="margin-bottom: 15px;">
                        <button onclick="selectAllCheckbox()">Select All</button>
                        <button onclick="clearCheckboxSelection()">Clear</button>
                    </div>
                    <t-tree id="checkbox-tree" selectable="multiple" show-checkboxes cascade-selection></t-tree>
                    <div class="selection-info">Selected: <span id="checkbox-selected">None</span></div>
                </div>

                <div class="demo-item">
                    <span class="demo-label">Searchable Tree</span>
                    <t-tree id="search-tree" searchable></t-tree>
                </div>
            </div>

            <h3>Advanced Features</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Expand/Collapse Controls</span>
                    <div class="controls" style="margin-bottom: 15px;">
                        <button onclick="expandAll()">Expand All</button>
                        <button onclick="collapseAll()">Collapse All</button>
                    </div>
                    <t-tree id="expand-tree"></t-tree>
                </div>

                <div class="demo-item">
                    <span class="demo-label">Draggable (Reorderable)</span>
                    <t-tree id="drag-tree" draggable></t-tree>
                </div>
            </div>

            <h3>Lazy Loading & Custom Icons</h3>
            <div class="demo-grid wide">
                <div class="demo-item">
                    <span class="demo-label">Lazy Loading</span>
                    <t-tree id="lazy-tree"></t-tree>
                </div>

                <div class="demo-item">
                    <span class="demo-label">Custom Icons & Metadata</span>
                    <t-tree id="icon-tree"></t-tree>
                </div>
            </div>

            <div class="code-block">
                <code>&lt;!-- Basic tree --&gt;
&lt;t-tree id="myTree"&gt;&lt;/t-tree&gt;

&lt;!-- Single selection --&gt;
&lt;t-tree selectable="single"&gt;&lt;/t-tree&gt;

&lt;!-- Multi-select with checkboxes --&gt;
&lt;t-tree selectable="multiple" show-checkboxes cascade-selection&gt;&lt;/t-tree&gt;

&lt;!-- Searchable --&gt;
&lt;t-tree searchable&gt;&lt;/t-tree&gt;

&lt;!-- Draggable --&gt;
&lt;t-tree draggable&gt;&lt;/t-tree&gt;

&lt;!-- JavaScript API --&gt;
&lt;script&gt;
  const tree = document.querySelector('t-tree');

  // Set nodes
  tree.nodes = [
    {
      id: 'folder1',
      label: 'Folder',
      children: [
        { id: 'file1', label: 'File.js' }
      ]
    }
  ];

  // Control methods
  tree.expandAll();
  tree.collapseAll();
  tree.clearSelection();

  // Events
  tree.addEventListener('selection-change', (e) =&gt; {
    console.log('Selected:', e.detail.selected);
  });
  tree.addEventListener('node-click', (e) =&gt; {});
  tree.addEventListener('node-expand', (e) =&gt; {});
  tree.addEventListener('lazy-load', (e) =&gt; {});
&lt;/script&gt;</code>
            </div>
        </div>

        <div class="event-log" id="eventLog">
            <h3>Event Log</h3>
        </div>
    </div>

    <script type="module">
        import '../js/components/TTreeLit.js';
        import { folderIcon, fileIcon, playIcon, imageIcon, noteBlankIcon } from '../js/utils/phosphor-icons.js';

        const eventLog = document.getElementById('eventLog');

        function logEvent(component, event, detail) {
            const entry = document.createElement('div');
            entry.className = 'event-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${component}: ${event} ${detail ? '- ' + JSON.stringify(detail) : ''}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // File system nodes
        const fileSystemNodes = [
            {
                id: 'src',
                label: 'src',
                children: [
                    {
                        id: 'components',
                        label: 'components',
                        children: [
                            { id: 'Button.js', label: 'Button.js' },
                            { id: 'Modal.js', label: 'Modal.js' },
                            { id: 'Tree.js', label: 'Tree.js' }
                        ]
                    },
                    {
                        id: 'utils',
                        label: 'utils',
                        children: [
                            { id: 'helpers.js', label: 'helpers.js' },
                            { id: 'constants.js', label: 'constants.js' }
                        ]
                    },
                    { id: 'index.js', label: 'index.js' }
                ]
            },
            {
                id: 'tests',
                label: 'tests',
                children: [
                    { id: 'Button.test.js', label: 'Button.test.js' },
                    { id: 'Modal.test.js', label: 'Modal.test.js' }
                ]
            },
            { id: 'package.json', label: 'package.json' }
        ];

        // Basic tree
        document.getElementById('basic-tree').nodes = fileSystemNodes;

        // Single selection
        const singleTree = document.getElementById('single-select');
        singleTree.nodes = fileSystemNodes;
        singleTree.addEventListener('selection-change', (e) => {
            document.getElementById('single-selected').textContent =
                e.detail.selected.length ? e.detail.selected.join(', ') : 'None';
            logEvent('single-select', 'selection-change', { count: e.detail.selected.length });
        });

        // Checkbox tree
        const checkboxTree = document.getElementById('checkbox-tree');
        checkboxTree.nodes = fileSystemNodes;
        checkboxTree.addEventListener('selection-change', (e) => {
            document.getElementById('checkbox-selected').textContent =
                e.detail.selected.length ? `${e.detail.selected.length} items` : 'None';
            logEvent('checkbox-tree', 'selection-change', { count: e.detail.selected.length });
        });

        window.selectAllCheckbox = () => {
            const getAllIds = (nodes) => nodes.reduce((ids, n) => {
                ids.push(n.id);
                if (n.children) ids.push(...getAllIds(n.children));
                return ids;
            }, []);
            checkboxTree.selected = getAllIds(fileSystemNodes);
        };
        window.clearCheckboxSelection = () => checkboxTree.clearSelection();

        // Expand/collapse tree
        const expandTree = document.getElementById('expand-tree');
        expandTree.nodes = fileSystemNodes;
        window.expandAll = () => expandTree.expandAll();
        window.collapseAll = () => expandTree.collapseAll();

        // Search tree
        document.getElementById('search-tree').nodes = fileSystemNodes;

        // Draggable tree
        const dragTree = document.getElementById('drag-tree');
        dragTree.nodes = [
            { id: '1', label: 'Item 1' },
            { id: '2', label: 'Item 2' },
            { id: '3', label: 'Item 3' },
            { id: '4', label: 'Item 4' }
        ];
        dragTree.addEventListener('node-drop', (e) => logEvent('drag-tree', 'node-drop', e.detail));

        // Lazy loading tree
        const lazyTree = document.getElementById('lazy-tree');
        lazyTree.nodes = [
            { id: 'lazy1', label: 'Projects', lazy: true },
            { id: 'lazy2', label: 'Documents', lazy: true },
            { id: 'lazy3', label: 'Downloads', lazy: true }
        ];

        lazyTree.addEventListener('lazy-load', (e) => {
            const nodeId = e.detail.id;
            logEvent('lazy-tree', 'lazy-load', { id: nodeId });

            setTimeout(() => {
                const children = [
                    { id: `${nodeId}-1`, label: `${e.detail.node.label} Item 1` },
                    { id: `${nodeId}-2`, label: `${e.detail.node.label} Item 2` },
                    { id: `${nodeId}-3`, label: `${e.detail.node.label} Item 3`, lazy: true }
                ];

                const updateNodes = (nodes) => nodes.map(node => {
                    if (node.id === nodeId) return { ...node, children, lazy: false };
                    if (node.children) return { ...node, children: updateNodes(node.children) };
                    return node;
                });

                lazyTree.nodes = updateNodes(lazyTree.nodes);
                lazyTree.setNodeLoading(nodeId, false);
            }, 1000);
        });

        // Custom icons tree
        const iconTree = document.getElementById('icon-tree');
        iconTree.nodes = [
            {
                id: 'music',
                label: 'Music',
                icon: playIcon,
                children: [
                    { id: 'song1', label: 'Synthwave.mp3', icon: playIcon, meta: '3:45' },
                    { id: 'song2', label: 'Ambient.mp3', icon: playIcon, meta: '5:20' }
                ]
            },
            {
                id: 'photos',
                label: 'Photos',
                icon: imageIcon,
                children: [
                    { id: 'photo1', label: 'Vacation.jpg', icon: imageIcon, meta: '2.4 MB' }
                ]
            },
            { id: 'notes', label: 'Notes.txt', icon: noteBlankIcon, meta: '4 KB' }
        ];

        // Listen to all tree events
        document.querySelectorAll('t-tree').forEach(tree => {
            tree.addEventListener('node-click', (e) => logEvent(tree.id || 'tree', 'node-click', { id: e.detail.id }));
            tree.addEventListener('node-expand', (e) => logEvent(tree.id || 'tree', 'node-expand', { id: e.detail.id }));
        });

        logEvent('System', 'Demo initialized');
    </script>
</body>
</html>
