<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>DataManager Integration Demo</title>
	<link rel="stylesheet" href="../css/styles.css">
	<link rel="stylesheet" href="../css/components/dropdown.css">
	<link rel="stylesheet" href="../css/components/color-picker.css">
	<link rel="stylesheet" href="../css/components/tree-view.css">
	<style>
		body {
			padding: 20px;
			background: #1a1a1a;
			color: #e0e0e0;
			font-family: 'SF Mono', monospace;
		}
		.demo-container {
			max-width: 1200px;
			margin: 0 auto;
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
		}
		.panel {
			background: #2a2a2a;
			border: 1px solid #3a3a3a;
			border-radius: 4px;
			padding: 20px;
		}
		.panel h2 {
			margin-top: 0;
			color: #00ff00;
			font-size: 14px;
			text-transform: uppercase;
		}
		.workspace-indicator {
			display: inline-block;
			padding: 4px 8px;
			background: #00ff00;
			color: #000;
			border-radius: 3px;
			font-size: 12px;
			font-weight: bold;
		}
		.workspace-indicator.work {
			background: #00a0ff;
		}
		.actions {
			display: flex;
			gap: 10px;
			margin: 20px 0;
			flex-wrap: wrap;
		}
		button {
			padding: 8px 16px;
			background: #3a3a3a;
			color: #e0e0e0;
			border: 1px solid #4a4a4a;
			border-radius: 3px;
			cursor: pointer;
			font-family: inherit;
		}
		button:hover {
			background: #4a4a4a;
			color: #00ff00;
		}
		.list-item {
			padding: 8px;
			margin: 4px 0;
			background: #1a1a1a;
			border: 1px solid #3a3a3a;
			border-radius: 3px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.tag {
			display: inline-block;
			padding: 2px 6px;
			background: #4a4a4a;
			border-radius: 2px;
			font-size: 11px;
			margin-left: 4px;
		}
		.swatch-list {
			display: flex;
			gap: 5px;
			flex-wrap: wrap;
		}
		.swatch {
			width: 30px;
			height: 30px;
			border-radius: 3px;
			border: 1px solid #4a4a4a;
			cursor: pointer;
		}
		#log {
			max-height: 200px;
			overflow-y: auto;
			background: #1a1a1a;
			padding: 10px;
			border: 1px solid #3a3a3a;
			border-radius: 3px;
			font-size: 12px;
			font-family: monospace;
		}
		.log-entry {
			margin: 2px 0;
		}
		.log-create { color: #00ff00; }
		.log-update { color: #00a0ff; }
		.log-delete { color: #ff4444; }
		.stats {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			gap: 10px;
			margin: 20px 0;
		}
		.stat {
			text-align: center;
			padding: 10px;
			background: #1a1a1a;
			border: 1px solid #3a3a3a;
			border-radius: 3px;
		}
		.stat-value {
			font-size: 24px;
			font-weight: bold;
			color: #00ff00;
		}
		.stat-label {
			font-size: 11px;
			color: #888;
			text-transform: uppercase;
		}
	</style>
</head>
<body>
	<h1>DataManager Integration Demo</h1>
	<p>Workspace: <span id="currentWorkspace" class="workspace-indicator">personal</span></p>

	<div class="demo-container">
		<!-- Control Panel -->
		<div class="panel">
			<h2>Control Panel</h2>

			<div class="actions">
				<button id="switchWorkspace">Switch Workspace</button>
				<button id="createAnimation">Create Animation</button>
				<button id="createFolder">Create Folder</button>
				<button id="createTag">Create Tag</button>
				<button id="clearData">Clear All Data</button>
			</div>

			<div class="stats">
				<div class="stat">
					<div class="stat-value" id="animationCount">0</div>
					<div class="stat-label">Animations</div>
				</div>
				<div class="stat">
					<div class="stat-value" id="folderCount">0</div>
					<div class="stat-label">Folders</div>
				</div>
				<div class="stat">
					<div class="stat-value" id="tagCount">0</div>
					<div class="stat-label">Tags</div>
				</div>
			</div>

			<h3>Activity Log</h3>
			<div id="log"></div>
		</div>

		<!-- Data Display -->
		<div class="panel">
			<h2>Data View</h2>

			<h3>Animations</h3>
			<div id="animationsList"></div>

			<h3>Folders</h3>
			<div id="foldersList"></div>

			<h3>Tags</h3>
			<div id="tagsList"></div>

			<h3>Workspace Swatches</h3>
			<div id="swatchesList" class="swatch-list"></div>
		</div>

		<!-- Color Picker Integration -->
		<div class="panel">
			<h2>Color Picker with DataManager</h2>
			<terminal-color-picker
				id="colorPicker"
				value="#00ff00"
				variant="full">
			</terminal-color-picker>
			<p id="selectedAnimation">No animation selected</p>
		</div>

		<!-- Tree View Integration -->
		<div class="panel">
			<h2>Folder Tree View</h2>
			<div id="treeContainer"></div>
		</div>
	</div>

	<script type="module">
		import { DataManager } from '../js/data/DataManager.js';
		import '../js/components/TerminalColorPicker.js';

		// Initialize DataManager
		const dm = new DataManager();
		let selectedAnimationId = null;

		// UI Elements
		const workspaceIndicator = document.getElementById('currentWorkspace');
		const animationCount = document.getElementById('animationCount');
		const folderCount = document.getElementById('folderCount');
		const tagCount = document.getElementById('tagCount');
		const log = document.getElementById('log');
		const animationsList = document.getElementById('animationsList');
		const foldersList = document.getElementById('foldersList');
		const tagsList = document.getElementById('tagsList');
		const swatchesList = document.getElementById('swatchesList');
		const selectedAnimationEl = document.getElementById('selectedAnimation');
		const colorPicker = document.getElementById('colorPicker');

		// Subscribe to changes
		dm.subscribe('animations', (action, entity) => {
			logAction(action, 'Animation', entity);
			updateDisplay();
		});

		dm.subscribe('folders', (action, entity) => {
			logAction(action, 'Folder', entity);
			updateDisplay();
		});

		dm.subscribe('tags', (action, entity) => {
			logAction(action, 'Tag', entity);
			updateDisplay();
		});

		dm.subscribeWorkspace((newWorkspace, oldWorkspace) => {
			logAction('switch', 'Workspace', { from: oldWorkspace, to: newWorkspace });
			updateWorkspaceIndicator();
			updateDisplay();
		});

		// Event Handlers
		document.getElementById('switchWorkspace').addEventListener('click', async () => {
			const current = dm.workspace;
			const next = current === 'personal' ? 'work' : 'personal';
			await dm.switchWorkspace(next);
		});

		document.getElementById('createAnimation').addEventListener('click', async () => {
			const name = prompt('Animation name:');
			if (!name) return;

			const animation = await dm.create('animations', {
				name,
				duration: Math.floor(Math.random() * 5000) + 1000,
				tags: []
			});

			// Add some sample swatches
			await dm.addSwatch(animation.id, '#FF0000');
			await dm.addSwatch(animation.id, '#00FF00');
			await dm.addSwatch(animation.id, '#0000FF');
		});

		document.getElementById('createFolder').addEventListener('click', async () => {
			const name = prompt('Folder name:');
			if (!name) return;

			await dm.create('folders', {
				name,
				parentId: null
			});
		});

		document.getElementById('createTag').addEventListener('click', async () => {
			const name = prompt('Tag name:');
			if (!name) return;

			await dm.create('tags', {
				name,
				color: `#${Math.floor(Math.random()*16777215).toString(16)}`
			});
		});

		document.getElementById('clearData').addEventListener('click', () => {
			if (!confirm('Clear all data in current workspace?')) return;

			// Clear localStorage for this workspace
			localStorage.clear();
			location.reload();
		});

		// ColorPicker integration
		colorPicker.addEventListener('color-change', async (e) => {
			if (!selectedAnimationId) return;

			const color = e.detail.color;
			await dm.addSwatch(selectedAnimationId, color);
			updateSwatches();
		});

		// Display Functions
		function updateDisplay() {
			updateStats();
			updateAnimationsList();
			updateFoldersList();
			updateTagsList();
			updateSwatches();
		}

		async function updateStats() {
			const animations = await dm.query('animations');
			const folders = await dm.query('folders');
			const tags = await dm.query('tags');

			animationCount.textContent = animations.length;
			folderCount.textContent = folders.length;
			tagCount.textContent = tags.length;
		}

		async function updateAnimationsList() {
			const animations = await dm.query('animations', {
				sort: { field: 'createdAt', order: 'desc' }
			});

			animationsList.innerHTML = animations.map(a => `
				<div class="list-item">
					<span>${a.name} (${a.duration}ms)</span>
					<button onclick="selectAnimation('${a.id}', '${a.name}')">Select</button>
				</div>
			`).join('');
		}

		async function updateFoldersList() {
			const folders = await dm.query('folders', {
				sort: { field: 'name', order: 'asc' }
			});

			foldersList.innerHTML = folders.map(f => `
				<div class="list-item">
					<span>${f.name}</span>
					<small>${f.parentId ? 'Has parent' : 'Root'}</small>
				</div>
			`).join('');
		}

		async function updateTagsList() {
			const tags = await dm.query('tags', {
				sort: { field: 'name', order: 'asc' }
			});

			tagsList.innerHTML = tags.map(t => `
				<div class="list-item">
					<span>${t.name}</span>
					<span class="tag" style="background: ${t.color}">${t.color}</span>
				</div>
			`).join('');
		}

		async function updateSwatches() {
			const swatches = await dm.getWorkspaceSwatches();
			swatchesList.innerHTML = swatches.map(color => `
				<div class="swatch" style="background: ${color}" title="${color}"></div>
			`).join('');
		}

		function updateWorkspaceIndicator() {
			workspaceIndicator.textContent = dm.workspace;
			workspaceIndicator.className = `workspace-indicator ${dm.workspace}`;
		}

		window.selectAnimation = async (id, name) => {
			selectedAnimationId = id;
			selectedAnimationEl.textContent = `Selected: ${name}`;

			// Load animation swatches into color picker
			const swatches = await dm.getSwatches(id);
			// In a real integration, we'd update the color picker's custom swatches
			console.log('Animation swatches:', swatches);
		};

		function logAction(action, type, entity) {
			const timestamp = new Date().toLocaleTimeString();
			const className = `log-${action}`;
			const message = `[${timestamp}] ${action.toUpperCase()} ${type}: ${entity.name || entity.to || entity.id}`;

			log.insertAdjacentHTML('afterbegin',
				`<div class="log-entry ${className}">${message}</div>`
			);

			// Limit log entries
			while (log.children.length > 20) {
				log.removeChild(log.lastChild);
			}
		}

		// Initial setup
		async function init() {
			// Create some sample data if empty
			const animations = await dm.query('animations');
			if (animations.length === 0) {
				// Personal workspace data
				await dm.create('animations', { name: 'Hero Animation', duration: 2000 });
				await dm.create('animations', { name: 'Loading Spinner', duration: 1000 });
				await dm.create('folders', { name: 'Components', parentId: null });
				await dm.create('tags', { name: 'featured', color: '#00ff00' });

				// Work workspace data
				await dm.switchWorkspace('work');
				await dm.create('animations', { name: 'Client Logo', duration: 3000 });
				await dm.create('folders', { name: 'Projects', parentId: null });
				await dm.create('tags', { name: 'production', color: '#ff0000' });

				// Switch back to personal
				await dm.switchWorkspace('personal');
			}

			updateDisplay();
			updateWorkspaceIndicator();
		}

		init();
	</script>
</body>
</html>