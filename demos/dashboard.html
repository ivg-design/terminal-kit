<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Kit Dashboard Demo</title>
    <link rel="stylesheet" href="../css/theme/terminal.css">
    <!-- GridStack CSS -->
    <style>
        :root {
            --terminal-black: #0a0a0a;
            --terminal-gray-darkest: #1a1a1a;
            --terminal-gray-dark: #333;
            --terminal-gray: #666;
            --terminal-gray-light: #888;
            --terminal-white: #fff;
            --terminal-green: #00ff41;
            --terminal-cyan: #00ffff;
            --terminal-amber: #ffb000;
            --terminal-red: #ff003c;
            --terminal-purple: #9d00ff;
            --font-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--font-mono);
            background: var(--terminal-black);
            color: var(--terminal-green);
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--terminal-gray-darkest);
            border-bottom: 1px solid var(--terminal-gray-dark);
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Main Content */
        .dashboard-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 200px;
            background: var(--terminal-gray-darkest);
            border-right: 1px solid var(--terminal-gray-dark);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow-y: auto;
        }

        .sidebar-section {
            padding: 12px;
            border-bottom: 1px solid var(--terminal-gray-dark);
        }

        .sidebar-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--terminal-gray-light);
            margin-bottom: 8px;
        }

        /* Grid Container */
        .grid-container {
            flex: 1;
            padding: 16px;
            overflow: auto;
            width: 100%;
            height: 100%;
        }

        /* Footer */
        .dashboard-footer {
            flex-shrink: 0;
        }

        /* Demo specific */
        .demo-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .demo-label {
            font-size: 10px;
            color: var(--terminal-gray-light);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .demo-section {
            margin-bottom: 16px;
        }

        .demo-section:last-child {
            margin-bottom: 0;
        }

        /* Mini chart placeholders */
        .mini-chart {
            height: 60px;
            background: linear-gradient(90deg,
                transparent 0%,
                var(--terminal-green) 20%,
                var(--terminal-green) 30%,
                transparent 50%,
                var(--terminal-cyan) 60%,
                var(--terminal-cyan) 80%,
                transparent 100%
            );
            opacity: 0.2;
            border-radius: 4px;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            padding: 12px;
            background: var(--terminal-black);
            border: 1px solid var(--terminal-gray-dark);
            border-radius: 4px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--terminal-white);
        }

        .stat-label {
            font-size: 10px;
            color: var(--terminal-gray-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            font-size: 11px;
            margin-top: 4px;
        }

        .stat-change.positive {
            color: var(--terminal-green);
        }

        .stat-change.negative {
            color: var(--terminal-red);
        }

        /* TGridLit Light DOM styles */
        t-grid {
            display: block;
            width: 100%;
            height: 100%;
            background: var(--terminal-black);
            position: relative;
        }

        t-grid.grid-stack {
            min-height: 100%;
        }

        /* Grid item styling */
        t-grid > .grid-stack-item > .grid-stack-item-content {
            background: var(--terminal-gray-darkest);
            border: 1px solid var(--terminal-gray-dark);
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Placeholder during drag */
        t-grid > .grid-stack-placeholder > .placeholder-content {
            background: rgba(0, 255, 65, 0.1);
            border: 2px dashed var(--terminal-green);
            border-radius: 4px;
        }

        /* Resize handles - hide any pseudo-elements, component handles its own icon */
        t-grid > .grid-stack-item > .ui-resizable-se::before,
        t-grid > .grid-stack-item > .ui-resizable-se::after {
            display: none !important;
        }

        /* Grid overlay */
        t-grid .grid-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease;
            z-index: 1000;
        }

        t-grid .grid-overlay.visible {
            opacity: 1;
        }

        t-grid .grid-overlay-cell {
            position: absolute;
            border: 1px dashed rgba(0, 255, 65, 0.2);
            box-sizing: border-box;
        }

        /* Item hover effect */
        t-grid > .grid-stack-item > .grid-stack-item-content:hover {
            box-shadow: 0 0 0 1px var(--terminal-green);
        }

        /* t-grid-item Light DOM styles */
        t-grid-item {
            display: block;
        }

        t-grid-item .grid-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--terminal-black);
            border-bottom: 1px solid var(--terminal-gray-dark);
            cursor: move;
        }

        t-grid-item .grid-item-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--terminal-green);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        t-grid-item .grid-item-content {
            flex: 1;
            padding: 12px;
            overflow: auto;
        }

        t-grid-item .grid-item-controls {
            display: flex;
            gap: 4px;
            align-items: center;
            cursor: default;
        }

        /* Styled scrollbar for grid item content */
        t-grid-item .grid-item-content::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        t-grid-item .grid-item-content::-webkit-scrollbar-track {
            background: var(--terminal-black);
        }

        t-grid-item .grid-item-content::-webkit-scrollbar-thumb {
            background: var(--terminal-gray-dark);
            border-radius: 3px;
        }

        t-grid-item .grid-item-content::-webkit-scrollbar-thumb:hover {
            background: var(--terminal-gray);
        }

        t-grid-item .grid-item-content {
            scrollbar-width: thin;
            scrollbar-color: var(--terminal-gray-dark) var(--terminal-black);
        }

        .grid-container::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .grid-container::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track {
            background: var(--terminal-black);
        }

        .grid-container::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--terminal-gray-dark);
            border-radius: 6px;
        }

        .grid-container::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--terminal-gray);
        }

        .grid-container,
        .sidebar {
            scrollbar-width: thin;
            scrollbar-color: var(--terminal-gray-dark) var(--terminal-black);
        }

        /* Widget Bank Drawer */
        .widget-bank {
            position: fixed;
            right: 0;
            top: 50px;
            bottom: 28px;
            width: 220px;
            background: var(--terminal-gray-darkest);
            border-left: 1px solid var(--terminal-gray-dark);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .widget-bank.open {
            transform: translateX(0);
        }

        .widget-bank-header {
            padding: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--terminal-gray-light);
            border-bottom: 1px solid var(--terminal-gray-dark);
        }

        .widget-bank-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .widget-bank-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            margin-bottom: 4px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--terminal-gray-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s, border-color 0.15s;
        }

        .widget-bank-item:hover {
            background: rgba(0, 255, 65, 0.1);
            border-color: var(--terminal-green);
        }

        .widget-bank-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--terminal-green);
        }

        .widget-bank-item-icon svg {
            width: 16px;
            height: 16px;
        }

        .widget-bank-item-name {
            font-size: 11px;
            color: var(--terminal-white);
        }

        /* Widget bank - active/disabled states */
        .widget-bank-item.active {
            background: rgba(0, 255, 65, 0.15);
            border-color: var(--terminal-green);
            opacity: 0.6;
            cursor: default;
        }

        .widget-bank-item.active::after {
            content: 'Added';
            font-size: 9px;
            color: var(--terminal-green);
            margin-left: auto;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .widget-bank-item.multi::after {
            content: '+';
            font-size: 14px;
            font-weight: bold;
            color: var(--terminal-cyan);
            margin-left: auto;
        }

        .widget-bank-item.active.multi {
            opacity: 1;
            cursor: pointer;
        }

        .widget-bank-item.active.multi::after {
            content: '+ More';
            font-size: 9px;
            color: var(--terminal-cyan);
        }

        /* Dev Console markdown/code styles */
        .dev-console-details {
            padding: 8px 0;
        }

        .dev-console-details .markdown-content {
            font-size: 12px;
            line-height: 1.5;
            color: var(--terminal-gray-light);
        }

        .dev-console-details .markdown-content h2,
        .dev-console-details .markdown-content h3 {
            color: var(--terminal-green);
            margin: 8px 0 4px;
            font-size: 13px;
        }

        .dev-console-details .markdown-content p {
            margin: 4px 0;
        }

        .dev-console-details .markdown-content code {
            background: rgba(0, 255, 65, 0.1);
            padding: 1px 4px;
            border-radius: 2px;
            font-family: var(--font-mono);
            color: var(--terminal-cyan);
        }

        .dev-console-details .markdown-content pre {
            background: var(--terminal-black);
            padding: 8px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .dev-console-details .markdown-content pre code {
            background: transparent;
            padding: 0;
        }

        .dev-console-details .markdown-content blockquote {
            border-left: 3px solid var(--terminal-amber);
            margin: 8px 0;
            padding-left: 12px;
            color: var(--terminal-gray);
        }

        .dev-console-details .markdown-content ul,
        .dev-console-details .markdown-content ol {
            padding-left: 20px;
            margin: 4px 0;
        }

        .dev-console-details .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
        }

        .dev-console-details .markdown-content th,
        .dev-console-details .markdown-content td {
            border: 1px solid var(--terminal-gray-dark);
            padding: 4px 8px;
            text-align: left;
        }

        .dev-console-details .markdown-content th {
            background: var(--terminal-black);
            color: var(--terminal-green);
        }

        .dev-console-details .code-content {
            margin-top: 8px;
        }

        .dev-console-details .code-content pre {
            background: var(--terminal-black);
            border: 1px solid var(--terminal-gray-dark);
            border-radius: 4px;
            padding: 12px;
            overflow-x: auto;
            margin: 0;
        }

        .dev-console-details .code-content code {
            font-family: var(--font-mono);
            font-size: 11px;
            line-height: 1.4;
        }

        /* Prism token colors for terminal theme */
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: var(--terminal-gray);
        }

        .token.punctuation {
            color: var(--terminal-gray-light);
        }

        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: var(--terminal-red, #ff003c);
        }

        .token.boolean,
        .token.number {
            color: var(--terminal-amber);
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: var(--terminal-green);
        }

        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string,
        .token.variable {
            color: var(--terminal-cyan);
        }

        .token.atrule,
        .token.attr-value,
        .token.function,
        .token.class-name {
            color: var(--terminal-yellow, #ffcc00);
        }

        .token.keyword {
            color: var(--terminal-purple, #9d00ff);
        }

        .token.regex,
        .token.important {
            color: var(--terminal-amber);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">> Terminal Kit</a>
            <t-chip label="Dashboard" variant="success" size="sm"></t-chip>
            <t-chip label="v1.0.0" size="sm"></t-chip>
        </div>
        <div class="header-right demo-header-controls">
            <t-btn id="toggle-widget-bank" variant="primary" size="sm">+ Add Widget</t-btn>
            <t-tog id="toggle-float" label="Float" size="sm" checked title="When enabled, widgets stay where dropped"></t-tog>
            <t-tog id="toggle-lock" label="Lock" size="sm" title="Lock all widgets"></t-tog>
            <t-btn id="compact-grid" variant="ghost" size="sm">Compact</t-btn>
            <t-btn id="reset-layout-btn" variant="ghost" size="sm">Reset</t-btn>
            <t-usr
                username="admin"
                email="admin@terminal.dev"
                avatar-text="AD"
                status="online"
            ></t-usr>
        </div>
    </header>

    <!-- Main Content -->
    <div class="dashboard-main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Navigation</div>
                <t-menu id="nav-menu" orientation="vertical"></t-menu>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Quick Actions</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <t-btn variant="primary" size="sm" block>New Project</t-btn>
                    <t-btn variant="secondary" size="sm" block>Import Data</t-btn>
                    <t-btn variant="ghost" size="sm" block>Settings</t-btn>
                </div>
            </div>
            <div class="sidebar-section" style="flex: 1;">
                <div class="sidebar-title">Activity Feed</div>
                <t-tmln id="activity-timeline" dense></t-tmln>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">System</div>
                <t-prg id="cpu-progress" value="67" label="CPU" show-label size="sm"></t-prg>
                <t-prg id="mem-progress" value="45" label="Memory" show-label size="sm" variant="info" style="margin-top: 8px;"></t-prg>
                <t-prg id="disk-progress" value="82" label="Disk" show-label size="sm" variant="warning" style="margin-top: 8px;"></t-prg>
            </div>
        </aside>

        <!-- Grid -->
        <main class="grid-container">
            <t-grid id="widget-grid" columns="24" cell-height="80" margin="8" show-overlay float lock-size>
                <!-- Widgets will be added dynamically -->
            </t-grid>
        </main>
    </div>

    <!-- Footer Status Bar -->
    <footer class="dashboard-footer">
        <t-sta>
            <t-sta-field slot="left" label="Status" value="Connected" variant="success"></t-sta-field>
            <t-sta-field slot="left" label="Widgets" id="widget-count-field" value="0"></t-sta-field>
            <t-sta-field slot="center" label="Dashboard" value="Terminal Kit v1.0.0"></t-sta-field>
            <t-sta-field slot="right" label="Memory" value="128MB"></t-sta-field>
            <t-sta-field slot="right" id="time-field" label="Time" value="00:00:00"></t-sta-field>
        </t-sta>
    </footer>

    <!-- Toast Container -->
    <t-tst id="toast"></t-tst>

    <!-- Widget Bank Drawer -->
    <aside class="widget-bank" id="widget-bank">
        <div class="widget-bank-header">Add Widget</div>
        <div class="widget-bank-content" id="widget-bank-content">
            <!-- Widget items populated by JS -->
        </div>
    </aside>

    <script type="module">
        import 'gridstack/dist/gridstack.min.css';
        import { GridStack } from 'gridstack';
        window.GridStack = GridStack;

        // Import all components
        import '../js/components/TGridLit.js';
        import '../js/components/TButtonLit.js';
        import '../js/components/TInputLit.js';
        import '../js/components/TSliderLit.js';
        import '../js/components/TToggleLit.js';
        import '../js/components/TDropdownLit.js';
        import '../js/components/TColorPickerLit.js';
        import '../js/components/TTextareaLit.js';
        import '../js/components/TPanelLit.js';
        import '../js/components/TModalLit.js';
        import '../js/components/TLoaderLit.js';
        import '../js/components/TToastLit.js';
        import '../js/components/TStatusBarLit.js';
        import '../js/components/TStatusFieldLit.js';
        import '../js/components/TUserMenuLit.js';
        import '../js/components/TBadgeLit.js';
        import '../js/components/TChipLit.js';
        import '../js/components/TAvatarLit.js';
        import '../js/components/TProgressLit.js';
        import '../js/components/TSkeletonLit.js';
        import '../js/components/TTooltipLit.js';
        import '../js/components/TTabsLit.js';
        import '../js/components/TAccordionLit.js';
        import '../js/components/TCardLit.js';
        import '../js/components/TMenuLit.js';
        import '../js/components/TListLit.js';
        import '../js/components/TTreeLit.js';
        import '../js/components/TTimelineLit.js';
        import '../js/components/TKanbanLit.js';
        import '../js/components/TCalendarLit.js';
        import '../js/components/TChartLit.js';
        import '../js/components/TLogListLit.js';
        import {
            chartBarIcon, listIcon, slidersHorizontalIcon,
            tableIcon, treeViewIcon, stackIcon,
            toggleLeftIcon, userCircleIcon, spinnerIcon, listChecksIcon, gaugeIcon, codeIcon
        } from '../js/utils/phosphor-icons.js';

        const grid = document.getElementById('widget-grid');
        const toast = document.getElementById('toast');
        const dashboardState = {
            interacting: false
        };

        function syncSquareCells() {
            const rect = grid.getBoundingClientRect();
            if (!rect.width) return;
            const columns = Number(grid.columns || 12);
            const margin = Number(grid.margin || 0);
            const cellWidth = (rect.width - (columns - 1) * margin) / columns;
            grid.cellHeight = Math.max(40, Math.round(cellWidth));
        }

        // Widget definitions with grid positions
        // multi: true = can be added multiple times, otherwise single instance only
        const widgetDefinitions = [
            {
                id: 'stats',
                name: 'System Stats',
                x: 0, y: 0, w: 4, h: 3,
                multi: true,  // Can add multiple stat cards
                content: `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">1,247</div>
                            <div class="stat-label">Active Users</div>
                            <div class="stat-change positive">+12.5%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">89.2%</div>
                            <div class="stat-label">Uptime</div>
                            <div class="stat-change positive">+0.3%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">42ms</div>
                            <div class="stat-label">Avg Response</div>
                            <div class="stat-change negative">-5ms</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">3.2k</div>
                            <div class="stat-label">Requests/min</div>
                            <div class="stat-change positive">+8.1%</div>
                        </div>
                    </div>
                `
            },
            {
                id: 'chart',
                name: 'Performance Metrics',
                x: 4, y: 0, w: 8, h: 4,
                multi: true,  // Can add multiple charts
                content: `<t-chart id="perf-chart" type="line" height="100%" show-grid style="height: 100%;"></t-chart>`
            },
            {
                id: 'logs',
                name: 'System Logs',
                x: 0, y: 4, w: 4, h: 5,
                multi: true,  // Can add multiple log lists
                content: `<t-log-list id="log-list" max-entries="100" auto-scroll style="height: 100%;"></t-log-list>`
            },
            {
                id: 'forms',
                name: 'Form Controls',
                x: 4, y: 4, w: 4, h: 5,
                content: `
                    <div class="demo-section">
                        <div class="demo-label">Input</div>
                        <t-inp placeholder="Enter value..." size="sm"></t-inp>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Slider</div>
                        <t-sld value="50" min="0" max="100" show-value size="sm"></t-sld>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Dropdown</div>
                        <t-drp id="demo-dropdown" placeholder="Select option" size="sm"></t-drp>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Color Picker</div>
                        <t-clr value="#00ff41" size="sm"></t-clr>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Toggles</div>
                        <div class="demo-row">
                            <t-tog label="Option A" size="sm" checked></t-tog>
                            <t-tog label="Option B" size="sm"></t-tog>
                        </div>
                    </div>
                `
            },
            {
                id: 'kanban',
                name: 'Task Board',
                x: 8, y: 4, w: 4, h: 5,
                content: `<t-kanban id="task-kanban" style="height: 100%;"></t-kanban>`
            },
            {
                id: 'calendar',
                name: 'Calendar',
                x: 0, y: 9, w: 4, h: 5,
                content: `<t-cal id="demo-calendar" style="width: 100%; height: 100%;"></t-cal>`
            },
            {
                id: 'tree',
                name: 'File Browser',
                x: 4, y: 9, w: 4, h: 4,
                content: `<t-tree id="file-tree" selectable="single" style="height: 100%;"></t-tree>`
            },
            {
                id: 'accordion',
                name: 'Documentation',
                x: 8, y: 9, w: 4, h: 4,
                content: `
                    <t-accordion id="docs-accordion">
                        <t-accordion-item item-id="getting-started" title="Getting Started" expanded>
                            <p style="color: var(--terminal-gray-light); font-size: 12px;">
                                Welcome to Terminal Kit! This library provides a comprehensive set of
                                terminal-styled web components built with Lit 3.x.
                            </p>
                        </t-accordion-item>
                        <t-accordion-item item-id="installation" title="Installation">
                            <pre style="color: var(--terminal-cyan); font-size: 11px;">npm install terminal-kit</pre>
                        </t-accordion-item>
                        <t-accordion-item item-id="components" title="Components" badge="35">
                            <p style="color: var(--terminal-gray-light); font-size: 12px;">
                                Includes buttons, inputs, panels, modals, charts, and more.
                            </p>
                        </t-accordion-item>
                    </t-accordion>
                `
            },
            {
                id: 'buttons',
                name: 'Button Variants',
                x: 0, y: 14, w: 4, h: 3,
                content: `
                    <div class="demo-section">
                        <div class="demo-label">Primary Actions</div>
                        <div class="demo-row">
                            <t-btn variant="primary" size="sm">Primary</t-btn>
                            <t-btn variant="secondary" size="sm">Secondary</t-btn>
                            <t-btn variant="ghost" size="sm">Ghost</t-btn>
                        </div>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Status Variants</div>
                        <div class="demo-row">
                            <t-btn variant="success" size="sm">Success</t-btn>
                            <t-btn variant="warning" size="sm">Warning</t-btn>
                            <t-btn variant="error" size="sm">Error</t-btn>
                        </div>
                    </div>
                `
            },
            {
                id: 'avatars',
                name: 'Team & Tags',
                x: 4, y: 14, w: 4, h: 3,
                content: `
                    <div class="demo-section">
                        <div class="demo-label">Avatars</div>
                        <div class="demo-row" style="gap: 8px;">
                            <t-avt initials="JD" status="online"></t-avt>
                            <t-avt initials="AS" status="busy" variant="warning"></t-avt>
                            <t-avt initials="MK" status="away" variant="info"></t-avt>
                            <t-avt initials="RB" status="offline"></t-avt>
                        </div>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Tags</div>
                        <div class="demo-row">
                            <t-chip label="Frontend" removable variant="success"></t-chip>
                            <t-chip label="Backend" removable variant="info"></t-chip>
                            <t-chip label="DevOps" removable variant="warning"></t-chip>
                        </div>
                    </div>
                `
            },
            {
                id: 'loaders',
                name: 'Loading States',
                x: 8, y: 14, w: 4, h: 3,
                content: `
                    <div class="demo-section">
                        <div class="demo-label">Spinners</div>
                        <div class="demo-row" style="gap: 16px;">
                            <t-ldr type="hollow-dots-spinner" size="sm" active></t-ldr>
                            <t-ldr type="orbit-spinner" size="sm" active></t-ldr>
                            <t-ldr type="bar-spinner" size="sm" active></t-ldr>
                            <t-ldr type="circle-spinner" size="sm" active></t-ldr>
                        </div>
                    </div>
                    <div class="demo-section">
                        <div class="demo-label">Progress</div>
                        <t-prg id="demo-progress" value="75" show-label striped animated></t-prg>
                    </div>
                `
            },
            {
                id: 'tabs',
                name: 'Data Views',
                x: 0, y: 17, w: 6, h: 3,
                content: `<t-tabs id="data-tabs"></t-tabs>`
            },
            {
                id: 'list',
                name: 'Recent Items',
                x: 6, y: 17, w: 6, h: 3,
                content: `<t-list id="recent-list" selectable="single" dense style="height: 100%;"></t-list>`
            },
            {
                id: 'dev-console',
                name: 'Dev Console',
                x: 0, y: 20, w: 12, h: 5,
                content: `<t-log-list id="dev-console-logs" max-entries="50" style="height: 100%;"></t-log-list>`
            }
        ];

        // Track active widgets
        const activeWidgets = new Map();

        // Wait for grid to be ready
        function waitForGrid() {
            return new Promise(resolve => {
                function check() {
                    if (grid._grid) {
                        resolve();
                    } else {
                        requestAnimationFrame(check);
                    }
                }
                setTimeout(check, 100);
            });
        }

        // Create a widget
        function createWidget(def) {
            const item = document.createElement('t-grid-item');
            item.setAttribute('gs-x', def.x);
            item.setAttribute('gs-y', def.y);
            item.setAttribute('gs-w', def.w);
            item.setAttribute('gs-h', def.h);
            item.setAttribute('gs-min-w', '2');
            item.setAttribute('gs-min-h', '2');
            item.setAttribute('item-id', def.id);
            item.setAttribute('widget-title', def.name);

            // Add content
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = def.content;
            while (contentDiv.firstChild) {
                item.appendChild(contentDiv.firstChild);
            }

            grid.appendChild(item);

            // Track widget
            activeWidgets.set(def.id, {
                id: def.id,
                element: item
            });
        }

        // Update widget count in status bar
        function updateWidgetCount() {
            const field = document.getElementById('widget-count-field');
            if (field) field.value = activeWidgets.size.toString();
        }

        // Initialize components with data
        function initializeComponentData() {
            // Nav Menu
            const navMenu = document.getElementById('nav-menu');
            if (navMenu) {
                navMenu.items = [
                    { id: 'dashboard', label: 'Dashboard', icon: 'grid' },
                    { id: 'analytics', label: 'Analytics', icon: 'chart' },
                    { id: 'projects', label: 'Projects', icon: 'folder', badge: '3' },
                    { id: 'team', label: 'Team', icon: 'users' },
                    { id: 'settings', label: 'Settings', icon: 'gear' }
                ];
            }

            // Activity Timeline
            const timeline = document.getElementById('activity-timeline');
            if (timeline) {
                timeline.items = [
                    { id: '1', title: 'Deployment completed', time: '2 min ago', variant: 'success' },
                    { id: '2', title: 'New user registered', time: '15 min ago', variant: 'info' },
                    { id: '3', title: 'Error in API endpoint', time: '1 hour ago', variant: 'error' },
                    { id: '4', title: 'Database backup', time: '3 hours ago', variant: 'default' }
                ];
            }

            // Performance Chart
            customElements.whenDefined('t-chart').then(() => {
                const perfChart = document.getElementById('perf-chart');
                if (perfChart && perfChart.setData) {
                    perfChart.setData([
                        { label: '00:00', value: 45 },
                        { label: '02:00', value: 52 },
                        { label: '04:00', value: 38 },
                        { label: '06:00', value: 41 },
                        { label: '08:00', value: 55 },
                        { label: '10:00', value: 42 },
                        { label: '12:00', value: 48 },
                        { label: '14:00', value: 51 },
                        { label: '16:00', value: 44 },
                        { label: '18:00', value: 39 },
                        { label: '20:00', value: 47 },
                        { label: '22:00', value: 43 }
                    ]);
                }
            });

            // Demo Dropdown
            setTimeout(() => {
                const demoDropdown = document.getElementById('demo-dropdown');
                if (demoDropdown && demoDropdown.setOptions) {
                    demoDropdown.setOptions([
                        { value: 'opt1', label: 'Option 1' },
                        { value: 'opt2', label: 'Option 2' },
                        { value: 'opt3', label: 'Option 3' }
                    ]);
                }
            }, 500);

            // Kanban Board
            setTimeout(() => {
                const kanban = document.getElementById('task-kanban');
                if (kanban) {
                    kanban.innerHTML = `
                        <t-kanban-column column-id="todo" title="To Do" color="gray">
                            <t-kanban-card card-id="1" title="Implement auth"></t-kanban-card>
                            <t-kanban-card card-id="2" title="Design UI"></t-kanban-card>
                        </t-kanban-column>
                        <t-kanban-column column-id="progress" title="In Progress" color="amber">
                            <t-kanban-card card-id="3" title="API docs"></t-kanban-card>
                        </t-kanban-column>
                        <t-kanban-column column-id="done" title="Done" color="green">
                            <t-kanban-card card-id="4" title="Setup CI/CD"></t-kanban-card>
                        </t-kanban-column>
                    `;
                }
            }, 500);

            // File Tree
            setTimeout(() => {
                const fileTree = document.getElementById('file-tree');
                if (fileTree) {
                    fileTree.nodes = [
                        {
                            id: 'src', label: 'src', expanded: true,
                            children: [
                                {
                                    id: 'components', label: 'components',
                                    children: [
                                        { id: 'button', label: 'TButtonLit.js' },
                                        { id: 'input', label: 'TInputLit.js' },
                                        { id: 'slider', label: 'TSliderLit.js' },
                                        { id: 'toggle', label: 'TToggleLit.js' }
                                    ]
                                },
                                {
                                    id: 'utils', label: 'utils',
                                    children: [
                                        { id: 'logger', label: 'logger.js' },
                                        { id: 'icons', label: 'phosphor-icons.js' }
                                    ]
                                },
                                { id: 'index', label: 'index.js' }
                            ]
                        },
                        {
                            id: 'tests', label: 'tests',
                            children: [
                                { id: 'test-button', label: 'TButtonLit.test.js' },
                                { id: 'test-input', label: 'TInputLit.test.js' }
                            ]
                        },
                        { id: 'package', label: 'package.json' },
                        { id: 'readme', label: 'README.md' }
                    ];
                }
            }, 500);

            // Data Tabs
            setTimeout(() => {
                const dataTabs = document.getElementById('data-tabs');
                if (dataTabs) {
                    dataTabs.tabs = [
                        { id: 'table', label: 'Table View', content: '<div style="padding: 16px; color: #888;">Table data with sortable columns.</div>' },
                        { id: 'json', label: 'JSON View', content: '<pre style="padding: 16px; color: var(--terminal-cyan); font-size: 11px;">{ "data": [...] }</pre>' },
                        { id: 'raw', label: 'Raw Data', content: '<div style="padding: 16px; color: #888;">Raw data view.</div>' }
                    ];
                }
            }, 500);

            // Recent List
            setTimeout(() => {
                const recentList = document.getElementById('recent-list');
                if (recentList) {
                    recentList.items = [
                        { id: '1', label: 'project-alpha.zip', secondary: '2.4 MB • Just now' },
                        { id: '2', label: 'dashboard-v3.fig', secondary: '8.1 MB • 5 min ago' },
                        { id: '3', label: 'api-docs.md', secondary: '124 KB • 1 hour ago' },
                        { id: '4', label: 'database.sql', secondary: '45 MB • 3 hours ago' }
                    ];
                }
            }, 500);

            // Log List - Add initial logs
            setTimeout(() => {
                const logList = document.getElementById('log-list');
                if (logList && logList.addEntry) {
                    const logLevels = ['debug', 'info', 'warn', 'error', 'success'];
                    const logMessages = [
                        'Server started on port 3000',
                        'Database connection established',
                        'User authentication successful',
                        'Cache invalidated',
                        'API request completed in 42ms'
                    ];

                    for (let i = 0; i < 5; i++) {
                        const level = logLevels[Math.floor(Math.random() * logLevels.length)];
                        const message = logMessages[Math.floor(Math.random() * logMessages.length)];
                        logList.addEntry({ level, message, timestamp: new Date().toISOString() });
                    }

                    // Simulate live logs
                    setInterval(() => {
                        if (dashboardState.interacting) return;
                        const level = logLevels[Math.floor(Math.random() * logLevels.length)];
                        const message = logMessages[Math.floor(Math.random() * logMessages.length)];
                        logList.addEntry({ level, message, timestamp: new Date().toISOString() });
                    }, 5000);
                }
            }, 500);

            // Dev Console with markdown and code blocks
            setTimeout(() => {
                const devConsole = document.getElementById('dev-console-logs');
                if (devConsole) {
                    // Sample entries with expandable markdown and code content
                    const devEntries = [
                        {
                            level: 'info',
                            message: 'Build completed successfully',
                            timestamp: new Date(Date.now() - 300000).toISOString(),
                            source: 'webpack',
                            expandable: true,
                            details: {
                                'Duration': '4.23s',
                                'Chunks': '12',
                                'Modules': '847'
                            },
                            markdownContent: `## Build Summary

**Status:** ✅ Success
**Environment:** Production

### Output Files
- \`main.bundle.js\` - 245KB (gzipped: 78KB)
- \`vendor.bundle.js\` - 512KB (gzipped: 156KB)
- \`styles.css\` - 42KB

> All assets optimized and ready for deployment.`
                        },
                        {
                            level: 'error',
                            message: 'TypeError: Cannot read property \'map\' of undefined',
                            timestamp: new Date(Date.now() - 240000).toISOString(),
                            source: 'app.js:142',
                            expandable: true,
                            stackTrace: `at UserList.render (app.js:142:23)
at Component.update (lit-element.js:234:12)
at scheduleUpdate (lit-element.js:189:8)
at async Promise.resolve`,
                            codeContent: {
                                language: 'javascript',
                                code: `// Error occurred in UserList component
render() {
  // users is undefined when API call fails
  return html\`
    <ul>
      \${this.users.map(user => html\`
        <li>\${user.name}</li>
      \`)}
    </ul>
  \`;
}

// Fix: Add null check
render() {
  return html\`
    <ul>
      \${(this.users || []).map(user => html\`
        <li>\${user.name}</li>
      \`)}
    </ul>
  \`;
}`
                            }
                        },
                        {
                            level: 'warn',
                            message: 'Deprecated API usage detected',
                            timestamp: new Date(Date.now() - 180000).toISOString(),
                            source: 'api-client',
                            expandable: true,
                            markdownContent: `### Deprecation Warning

The \`/api/v1/users\` endpoint will be removed in **v4.0.0**.

**Migration Steps:**
1. Update API calls to use \`/api/v2/users\`
2. Update response handlers for new schema
3. Test thoroughly before deploying

See [Migration Guide](https://docs.example.com/migration) for details.`,
                            codeContent: {
                                language: 'javascript',
                                code: `// Before (deprecated)
const users = await api.get('/api/v1/users');

// After (recommended)
const users = await api.get('/api/v2/users');
// Note: v2 returns { data: [...], meta: {...} }`
                            }
                        },
                        {
                            level: 'success',
                            message: 'Database migration completed',
                            timestamp: new Date(Date.now() - 120000).toISOString(),
                            source: 'prisma',
                            expandable: true,
                            details: {
                                'Tables Created': '3',
                                'Indexes Added': '7',
                                'Seed Data': '150 rows'
                            },
                            codeContent: {
                                language: 'sql',
                                code: `-- Migration: add_user_preferences
CREATE TABLE user_preferences (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  theme VARCHAR(20) DEFAULT 'dark',
  notifications BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_user_prefs_user_id
  ON user_preferences(user_id);`
                            }
                        },
                        {
                            level: 'debug',
                            message: 'WebSocket connection established',
                            timestamp: new Date(Date.now() - 60000).toISOString(),
                            source: 'ws-client',
                            expandable: true,
                            details: {
                                'Protocol': 'wss',
                                'Latency': '23ms',
                                'Reconnect Attempts': '0'
                            },
                            markdownContent: `### Connection Details

| Property | Value |
|----------|-------|
| URL | \`wss://api.example.com/ws\` |
| Protocol | WebSocket Secure |
| Compression | ✅ Enabled |

**Subscribed Channels:**
- \`user.notifications\`
- \`system.alerts\`
- \`data.updates\``
                        }
                    ];

                    // Add entries to dev console
                    devEntries.forEach(entry => {
                        // Create the log entry element
                        const logEntry = document.createElement('t-log-entry');
                        logEntry.level = entry.level;
                        logEntry.message = entry.message;
                        logEntry.timestamp = entry.timestamp;
                        logEntry.source = entry.source;
                        logEntry.expandable = entry.expandable;
                        if (entry.details) logEntry.details = entry.details;
                        if (entry.stackTrace) logEntry.stackTrace = entry.stackTrace;

                        // Create details slot content with markdown/code
                        if (entry.markdownContent || entry.codeContent) {
                            const detailsDiv = document.createElement('div');
                            detailsDiv.slot = 'details';
                            detailsDiv.className = 'dev-console-details';

                            if (entry.markdownContent) {
                                const mdDiv = document.createElement('div');
                                mdDiv.className = 'markdown-content';
                                // Use marked to render markdown (loaded from TChatPanelLit)
                                import('marked').then(({ marked }) => {
                                    mdDiv.innerHTML = marked.parse(entry.markdownContent);
                                }).catch(() => {
                                    // Fallback: show as preformatted text
                                    mdDiv.innerHTML = '<pre>' + entry.markdownContent + '</pre>';
                                });
                                detailsDiv.appendChild(mdDiv);
                            }

                            if (entry.codeContent) {
                                const codeDiv = document.createElement('div');
                                codeDiv.className = 'code-content';
                                const pre = document.createElement('pre');
                                const code = document.createElement('code');
                                code.className = 'language-' + entry.codeContent.language;
                                code.textContent = entry.codeContent.code;
                                pre.appendChild(code);
                                codeDiv.appendChild(pre);
                                detailsDiv.appendChild(codeDiv);

                                // Highlight with Prism
                                import('prismjs').then((Prism) => {
                                    Prism.default.highlightElement(code);
                                }).catch(() => {
                                    // Prism not available, code still shows
                                });
                            }

                            logEntry.appendChild(detailsDiv);
                        }

                        devConsole.appendChild(logEntry);
                    });
                }
            }, 600);

            // Update time field
            const updateTime = () => {
                const timeField = document.getElementById('time-field');
                if (timeField) timeField.value = new Date().toLocaleTimeString();
            };
            updateTime();
            setInterval(updateTime, 1000);

            // Simulate system stats updates
            setInterval(() => {
                if (dashboardState.interacting) return;
                const cpu = document.getElementById('cpu-progress');
                const mem = document.getElementById('mem-progress');
                if (cpu) cpu.value = 50 + Math.random() * 40;
                if (mem) mem.value = 30 + Math.random() * 50;
            }, 5000);
        }

        // Initialize event handlers
        function initEventHandlers() {
            grid.addEventListener('grid-drag-start', () => {
                dashboardState.interacting = true;
            });
            grid.addEventListener('grid-resize-start', () => {
                dashboardState.interacting = true;
            });
            grid.addEventListener('grid-drag-stop', () => {
                dashboardState.interacting = false;
            });
            grid.addEventListener('grid-resize-stop', () => {
                dashboardState.interacting = false;
            });

            // Float toggle
            document.getElementById('toggle-float').addEventListener('toggle-change', (e) => {
                grid.float = e.detail.checked;
            });

            // Lock toggle
            document.getElementById('toggle-lock').addEventListener('toggle-change', (e) => {
                grid.setStatic(e.detail.checked);
                toast.show({ message: e.detail.checked ? 'Dashboard locked' : 'Dashboard unlocked', variant: 'info' });
            });

            // Compact button
            document.getElementById('compact-grid').addEventListener('button-click', () => {
                grid.compactGrid();
                toast.show({ message: 'Layout compacted', variant: 'info' });
            });

            // Reset button
            document.getElementById('reset-layout-btn').addEventListener('button-click', () => {
                location.reload();
            });

            // Nav Menu Selection
            const navMenu = document.getElementById('nav-menu');
            if (navMenu) {
                navMenu.addEventListener('menu-select', (e) => {
                    toast.show({ message: `Navigating to ${e.detail.item.label}`, variant: 'info' });
                });
            }

            // User Menu Events
            const userMenu = document.querySelector('t-usr');
            if (userMenu) {
                userMenu.addEventListener('user-menu-action', (e) => {
                    toast.show({ message: `Action: ${e.detail.action}`, variant: 'info' });
                });
            }

            // Widget Bank Toggle (header button)
            const widgetBank = document.getElementById('widget-bank');
            const widgetBankBtn = document.getElementById('toggle-widget-bank');
            widgetBankBtn.addEventListener('button-click', () => {
                widgetBank.classList.toggle('open');
            });

            // Close widget bank when clicking outside
            document.addEventListener('click', (e) => {
                if (widgetBank.classList.contains('open') &&
                    !widgetBank.contains(e.target) &&
                    !widgetBankBtn.contains(e.target)) {
                    widgetBank.classList.remove('open');
                }
            });
        }

        // Populate Widget Bank
        function populateWidgetBank() {
            const bankContent = document.getElementById('widget-bank-content');

            // Widget templates for bank (with multi flag from definitions)
            const widgetTemplates = [
                { id: 'stats', name: 'Stats Card', icon: gaugeIcon },
                { id: 'chart', name: 'Chart', icon: chartBarIcon },
                { id: 'logs', name: 'Log List', icon: listChecksIcon },
                { id: 'forms', name: 'Form Controls', icon: slidersHorizontalIcon },
                { id: 'kanban', name: 'Kanban Board', icon: tableIcon },
                { id: 'calendar', name: 'Calendar', icon: listIcon },
                { id: 'tree', name: 'File Tree', icon: treeViewIcon },
                { id: 'accordion', name: 'Accordion', icon: stackIcon },
                { id: 'buttons', name: 'Buttons', icon: toggleLeftIcon },
                { id: 'avatars', name: 'Avatars & Tags', icon: userCircleIcon },
                { id: 'loaders', name: 'Loaders', icon: spinnerIcon },
                { id: 'tabs', name: 'Tabs', icon: stackIcon },
                { id: 'list', name: 'List', icon: listIcon },
                { id: 'dev-console', name: 'Dev Console', icon: codeIcon }
            ];

            // Get multi flag from widget definitions
            const getMulti = (id) => widgetDefinitions.find(d => d.id === id)?.multi || false;

            bankContent.innerHTML = widgetTemplates.map(template => {
                const isMulti = getMulti(template.id);
                return `
                <div class="widget-bank-item${isMulti ? ' multi' : ''}" data-widget-id="${template.id}" data-multi="${isMulti}">
                    <span class="widget-bank-item-icon">${template.icon}</span>
                    <span class="widget-bank-item-name">${template.name}</span>
                </div>
            `}).join('');

            // Add click handlers
            bankContent.querySelectorAll('.widget-bank-item').forEach(item => {
                item.addEventListener('click', () => {
                    const widgetId = item.dataset.widgetId;
                    const def = widgetDefinitions.find(d => d.id === widgetId);
                    const isMulti = item.dataset.multi === 'true';

                    if (def && (isMulti || !activeWidgets.has(widgetId))) {
                        // For multi widgets, generate unique ID
                        const uniqueDef = isMulti ? { ...def, id: `${def.id}-${Date.now()}` } : def;
                        createWidget(uniqueDef);
                        updateWidgetCount();
                        updateWidgetBankStates();
                        toast.show({ message: `Added ${def.name}`, variant: 'success' });
                    } else if (activeWidgets.has(widgetId)) {
                        toast.show({ message: `${def.name} already on dashboard`, variant: 'warning' });
                    }
                });
            });
        }

        // Update widget bank item states based on active widgets
        function updateWidgetBankStates() {
            const bankContent = document.getElementById('widget-bank-content');
            if (!bankContent) return;

            bankContent.querySelectorAll('.widget-bank-item').forEach(item => {
                const widgetId = item.dataset.widgetId;
                const isMulti = item.dataset.multi === 'true';

                // Check if any widget with this base ID exists
                const hasWidget = Array.from(activeWidgets.keys()).some(id =>
                    id === widgetId || id.startsWith(`${widgetId}-`)
                );

                if (hasWidget) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Main initialization
        async function init() {
            console.log('Waiting for grid...');
            await waitForGrid();
            console.log('Grid ready, creating widgets...');
            syncSquareCells();

            // Populate widget bank
            populateWidgetBank();

            // Create all widgets
            widgetDefinitions.forEach(def => createWidget(def));
            updateWidgetCount();
            updateWidgetBankStates();

            // Initialize component data
            initializeComponentData();

            // Initialize event handlers
            initEventHandlers();

            console.log('Dashboard initialized with TGridLit');
        }

        // Start
        init();
    </script>
    <script type="module" src="../js/utils/demo-color-picker.js"></script>
</body>
</html>
