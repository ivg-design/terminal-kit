<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSD Final Test - Terminal Kit</title>
    <link rel="stylesheet" href="/css/theme.css">
    <style>
        body {
            padding: 2rem;
            background: var(--color-black);
            color: var(--color-green);
            font-family: var(--font-mono);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--color-green);
        }
        h2 {
            color: var(--color-primary);
            margin-bottom: 1rem;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .log-output {
            background: var(--color-gray-darker);
            padding: 1rem;
            margin-top: 2rem;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.875rem;
        }
        .log-entry {
            margin: 0.25rem 0;
            font-family: monospace;
        }
        .log-dsd {
            color: var(--color-success);
        }
        .log-dynamic {
            color: var(--color-warning);
        }
        .log-error {
            color: var(--color-danger);
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª DSD Implementation Test</h1>

    <div class="test-section">
        <h2>Test 1: Pre-rendered DSD Components</h2>
        <p>These components should have DSD templates injected by Vite plugin:</p>
        <div class="test-grid">
            <t-btn variant="primary">DSD Button 1</t-btn>
            <t-btn variant="secondary">DSD Button 2</t-btn>
            <t-btn variant="danger">DSD Button 3</t-btn>
        </div>

        <t-panel>
            <span slot="title">DSD Panel</span>
            This panel should be pre-rendered with DSD
        </t-panel>
    </div>

    <div class="test-section">
        <h2>Test 2: Dynamically Created Components</h2>
        <p>These components will be created via JavaScript:</p>
        <div id="dynamic-container" class="test-grid"></div>
        <button onclick="createDynamicComponents()">Create Dynamic Components</button>
    </div>

    <div class="test-section">
        <h2>Test 3: Hybrid - Dynamic Content with DSD</h2>
        <div id="hybrid-container"></div>
        <button onclick="createHybridContent()">Create Hybrid Content</button>
    </div>

    <div class="test-section">
        <h2>Component Statistics</h2>
        <div id="stats">
            <p>Total Components: <span id="total-count">0</span></p>
            <p>DSD Components: <span id="dsd-count">0</span> (<span id="dsd-percent">0%</span>)</p>
            <p>Dynamic Components: <span id="dynamic-count">0</span> (<span id="dynamic-percent">0%</span>)</p>
        </div>
    </div>

    <div class="log-output" id="log">
        <h3>Component Logs:</h3>
        <div id="log-entries"></div>
    </div>

    <script type="module">
        import '/js/index.js';
        import { DynamicPanelBuilder } from '/js/utils/DynamicPanelBuilder.js';
        import { setDSDHTML } from '/js/utils/DSDUtils.js';

        // Track component stats
        const stats = {
            total: 0,
            dsd: 0,
            dynamic: 0
        };

        // Custom logger to capture component initialization
        const originalLog = console.log;
        const originalInfo = console.info;
        const logEntries = document.getElementById('log-entries');

        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }

        // Override console methods to capture logs
        console.info = function(...args) {
            const msg = args.join(' ');
            if (msg.includes('Component mounted:')) {
                const match = msg.match(/renderMode: (\w+)/);
                if (match) {
                    stats.total++;
                    if (match[1] === 'dsd') {
                        stats.dsd++;
                        addLogEntry(`âœ“ ${msg}`, 'dsd');
                    } else {
                        stats.dynamic++;
                        addLogEntry(`âš¡ ${msg}`, 'dynamic');
                    }
                    updateStats();
                }
            }
            originalInfo.apply(console, args);
        };

        function updateStats() {
            document.getElementById('total-count').textContent = stats.total;
            document.getElementById('dsd-count').textContent = stats.dsd;
            document.getElementById('dynamic-count').textContent = stats.dynamic;

            const dsdPercent = stats.total > 0 ? Math.round((stats.dsd / stats.total) * 100) : 0;
            const dynamicPercent = stats.total > 0 ? Math.round((stats.dynamic / stats.total) * 100) : 0;

            document.getElementById('dsd-percent').textContent = dsdPercent + '%';
            document.getElementById('dynamic-percent').textContent = dynamicPercent + '%';
        }

        // Make functions global for onclick handlers
        window.createDynamicComponents = function() {
            const container = document.getElementById('dynamic-container');

            // Create buttons dynamically
            const btn1 = document.createElement('t-btn');
            btn1.setAttribute('variant', 'success');
            btn1.textContent = 'Dynamic Button 1';
            container.appendChild(btn1);

            const btn2 = document.createElement('t-btn');
            btn2.setAttribute('variant', 'warning');
            btn2.textContent = 'Dynamic Button 2';
            container.appendChild(btn2);

            addLogEntry('Created 2 dynamic components', 'info');
        };

        window.createHybridContent = function() {
            const container = document.getElementById('hybrid-container');
            const builder = new DynamicPanelBuilder();

            // Configuration for animation controls
            const config = {
                speed: {
                    type: 'slider',
                    min: 0,
                    max: 100,
                    default: 50,
                    label: 'Speed'
                },
                color: {
                    type: 'color-picker',
                    default: '#00ff00',
                    label: 'Color'
                },
                mode: {
                    type: 'dropdown',
                    options: ['linear', 'ease-in', 'ease-out'],
                    default: 'linear',
                    label: 'Mode'
                }
            };

            // Mount the panel with DSD
            const panel = builder.mountPanel(container, config, 'Hybrid Controls');

            builder.onChange(panel, (values, changedParam) => {
                addLogEntry(`Control changed: ${changedParam} = ${values[changedParam]}`, 'info');
            });

            addLogEntry('Created hybrid panel with DSD templates', 'info');
        };

        // Check initial components after page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addLogEntry(`Initial page load complete. Found ${stats.dsd} DSD components.`, 'info');
            }, 1000);
        });
    </script>
</body>
</html>