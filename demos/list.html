<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TListLit - Component Demo</title>
    <script src="../js/utils/accent-init.js"></script>
    <link rel="stylesheet" href="../css/demo-template.css">

    <style>
        t-list {
            height: 300px;
            width: 100%;
            max-width: 500px;
        }
        .selection-info {
            margin-top: 10px;
            font-size: 12px;
            color: var(--terminal-gray);
        }
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <header class="demo-header">
        <div class="demo-header-content">
            <div class="demo-header-left">
                <h1>TListLit</h1>
                <div class="breadcrumb">
                    <a href="index.html">← Components</a> / List
                </div>
            </div>
            <div class="demo-header-controls">
                <button class="header-btn" id="toggleLogBtn">▼ Event Log</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="demo-container">
        <div class="component-section">
            <h2 class="component-title">List Component</h2>
            <p class="component-description">
                Virtualized scrollable list with selection, grouping, drag-and-drop, and infinite scroll.
            </p>

            <h3>Basic List</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <t-list id="basic-list"></t-list>
                </div>
            </div>

            <h3>Single Selection</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <t-list id="single-select" selectable="single"></t-list>
                    <p class="selection-info">Selected: <span id="single-selected">None</span></p>
                </div>
            </div>

            <h3>Multiple Selection</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <div class="controls" style="margin-bottom: 10px;">
                        <button onclick="selectAll()">Select All</button>
                        <button onclick="clearSelection()">Clear Selection</button>
                    </div>
                    <t-list id="multi-select" selectable="multiple"></t-list>
                    <p class="selection-info">Selected: <span id="multi-selected">None</span></p>
                </div>
            </div>

            <h3>Variants: Dividers & Dense</h3>
            <div class="demo-grid">
                <div class="demo-item">
                    <span class="demo-label">With Dividers</span>
                    <t-list id="dividers-list" dividers style="height: 200px;"></t-list>
                </div>
                <div class="demo-item">
                    <span class="demo-label">Dense Mode</span>
                    <t-list id="dense-list" dense dividers style="height: 200px;"></t-list>
                </div>
            </div>

            <h3>Items with Secondary Text</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <t-list id="secondary-list" dividers></t-list>
                </div>
            </div>

            <h3>Grouped Items</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <t-list id="grouped-list" group-by="category" dividers></t-list>
                </div>
            </div>

            <h3>Draggable (Reorderable)</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <span class="demo-label">Drag items to reorder</span>
                    <t-list id="draggable-list" draggable></t-list>
                </div>
            </div>

            <h3>Loading States</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <div class="controls" style="margin-bottom: 10px;">
                        <button onclick="toggleLoading()">Toggle Loading</button>
                        <button onclick="toggleLoadingMore()">Toggle Load More</button>
                    </div>
                    <t-list id="loading-list"></t-list>
                </div>
            </div>

            <h3>Empty State</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <t-list id="empty-list" empty-text="No items to display" style="height: 150px;"></t-list>
                </div>
            </div>

            <h3>Infinite Scroll</h3>
            <div class="demo-grid single">
                <div class="demo-item">
                    <span class="demo-label">Scroll to bottom to load more items</span>
                    <t-list id="infinite-list" style="height: 250px;"></t-list>
                </div>
            </div>

            <div class="code-block">
                <code>&lt;!-- Basic list --&gt;
&lt;t-list id="list"&gt;&lt;/t-list&gt;
&lt;script&gt;
  document.getElementById('list').items = [
    { id: '1', label: 'Item 1' },
    { id: '2', label: 'Item 2' }
  ];
&lt;/script&gt;

&lt;!-- Single selection --&gt;
&lt;t-list selectable="single"&gt;&lt;/t-list&gt;

&lt;!-- Multiple selection --&gt;
&lt;t-list selectable="multiple"&gt;&lt;/t-list&gt;

&lt;!-- With secondary text --&gt;
&lt;script&gt;
  list.items = [
    { id: '1', label: 'File.js', secondary: 'Description' }
  ];
&lt;/script&gt;

&lt;!-- Grouped --&gt;
&lt;t-list group-by="category"&gt;&lt;/t-list&gt;

&lt;!-- Draggable --&gt;
&lt;t-list draggable&gt;&lt;/t-list&gt;</code>
            </div>
        </div>
    </div>

    <!-- Floating Event Log -->
    <div class="event-log-container collapsed" id="eventLogContainer">
        <div class="event-log-toggle">
            <h3><span class="toggle-icon">▲</span> Event Log</h3>
            <div class="event-log-controls">
                <span class="event-log-count">0</span>
                <button class="event-log-clear">Clear</button>
            </div>
        </div>
        <div class="event-log" id="eventLog"></div>
    </div>

    <script type="module">
        import '../js/components/TListLit.js';

        // Event log functionality
        let eventCount = 0;
        const eventLog = document.getElementById('eventLog');
        const eventLogContainer = document.getElementById('eventLogContainer');
        const countEl = document.querySelector('.event-log-count');
        const toggleLogBtn = document.getElementById('toggleLogBtn');

        function logEvent(component, event, detail) {
            const entry = document.createElement('div');
            entry.className = 'event-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${component}: ${event}${detail ? ' - ' + JSON.stringify(detail) : ''}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
            eventCount++;
            countEl.textContent = eventCount;
        }

        // Toggle event log
        document.querySelector('.event-log-toggle').addEventListener('click', (e) => {
            if (e.target.closest('.event-log-clear')) return;
            eventLogContainer.classList.toggle('collapsed');
            toggleLogBtn.classList.toggle('active');
        });

        toggleLogBtn.addEventListener('click', () => {
            eventLogContainer.classList.toggle('collapsed');
            toggleLogBtn.classList.toggle('active');
        });

        // Clear log
        document.querySelector('.event-log-clear').addEventListener('click', (e) => {
            e.stopPropagation();
            eventLog.innerHTML = '';
            eventCount = 0;
            countEl.textContent = '0';
        });

        // Basic items
        const basicItems = Array.from({ length: 20 }, (_, i) => ({
            id: `item-${i + 1}`,
            label: `Item ${i + 1}`
        }));

        // Items with secondary text
        const detailedItems = [
            { id: '1', label: 'dashboard.js', secondary: 'Main dashboard component' },
            { id: '2', label: 'api-client.js', secondary: 'API communication layer' },
            { id: '3', label: 'auth-service.js', secondary: 'Authentication handling' },
            { id: '4', label: 'config.json', secondary: 'Configuration settings' },
            { id: '5', label: 'utils.js', secondary: 'Utility functions', disabled: true },
            { id: '6', label: 'styles.css', secondary: 'Global stylesheet' },
            { id: '7', label: 'router.js', secondary: 'Navigation routing' },
            { id: '8', label: 'store.js', secondary: 'State management' }
        ];

        // Grouped items
        const groupedItems = [
            { id: '1', label: 'Apple', category: 'Fruits' },
            { id: '2', label: 'Banana', category: 'Fruits' },
            { id: '3', label: 'Orange', category: 'Fruits' },
            { id: '4', label: 'Carrot', category: 'Vegetables' },
            { id: '5', label: 'Broccoli', category: 'Vegetables' },
            { id: '6', label: 'Spinach', category: 'Vegetables' },
            { id: '7', label: 'Chicken', category: 'Proteins' },
            { id: '8', label: 'Salmon', category: 'Proteins' },
            { id: '9', label: 'Tofu', category: 'Proteins' }
        ];

        // Set up lists
        document.getElementById('basic-list').items = basicItems.slice(0, 10);
        document.getElementById('single-select').items = basicItems.slice(0, 10);
        document.getElementById('multi-select').items = basicItems.slice(0, 10);
        document.getElementById('dividers-list').items = basicItems.slice(0, 5);
        document.getElementById('dense-list').items = basicItems.slice(0, 8);
        document.getElementById('secondary-list').items = detailedItems;
        document.getElementById('grouped-list').items = groupedItems;
        document.getElementById('draggable-list').items = basicItems.slice(0, 6);
        document.getElementById('loading-list').items = basicItems.slice(0, 5);

        // Single selection tracking
        const singleSelect = document.getElementById('single-select');
        const singleDisplay = document.getElementById('single-selected');
        singleSelect.addEventListener('selection-change', (e) => {
            singleDisplay.textContent = e.detail.selected.length ? e.detail.selected.join(', ') : 'None';
            logEvent('single-select', 'selection-change', e.detail);
        });

        // Multiple selection tracking
        const multiSelect = document.getElementById('multi-select');
        const multiDisplay = document.getElementById('multi-selected');
        multiSelect.addEventListener('selection-change', (e) => {
            multiDisplay.textContent = e.detail.selected.length ? `${e.detail.selected.length} items` : 'None';
            logEvent('multi-select', 'selection-change', e.detail);
        });

        window.selectAll = () => multiSelect.selectAll();
        window.clearSelection = () => multiSelect.clearSelection();

        // Draggable list reorder
        const draggableList = document.getElementById('draggable-list');
        draggableList.addEventListener('reorder', (e) => {
            const { fromIndex, toIndex } = e.detail;
            const items = [...draggableList.items];
            const [removed] = items.splice(fromIndex, 1);
            items.splice(toIndex, 0, removed);
            draggableList.items = items;
            logEvent('draggable-list', 'reorder', e.detail);
        });

        // Loading states
        const loadingList = document.getElementById('loading-list');
        window.toggleLoading = () => {
            loadingList.loading = !loadingList.loading;
            logEvent('loading-list', 'loading', { loading: loadingList.loading });
        };
        window.toggleLoadingMore = () => {
            loadingList.loadingMore = !loadingList.loadingMore;
            logEvent('loading-list', 'loadingMore', { loadingMore: loadingList.loadingMore });
        };

        // Infinite scroll
        const infiniteList = document.getElementById('infinite-list');
        let infiniteItems = Array.from({ length: 20 }, (_, i) => ({
            id: `item-${i + 1}`,
            label: `Item ${i + 1}`
        }));
        infiniteList.items = infiniteItems;

        infiniteList.addEventListener('load-more', (e) => {
            if (infiniteList.loadingMore) return;

            infiniteList.loadingMore = true;
            logEvent('infinite-list', 'load-more', { currentCount: infiniteItems.length });

            // Simulate async loading
            setTimeout(() => {
                const startIndex = infiniteItems.length;
                const newItems = Array.from({ length: 10 }, (_, i) => ({
                    id: `item-${startIndex + i + 1}`,
                    label: `Item ${startIndex + i + 1}`
                }));
                infiniteItems = [...infiniteItems, ...newItems];
                infiniteList.items = infiniteItems;
                infiniteList.loadingMore = false;
            }, 1000);
        });

        // Listen to all list events
        document.querySelectorAll('t-list').forEach(list => {
            list.addEventListener('item-click', (e) => logEvent(list.id || 'list', 'item-click', e.detail));
        });

        logEvent('System', 'Demo initialized');
    </script>
    <script type="module" src="../js/utils/demo-color-picker.js"></script>
</body>
</html>
